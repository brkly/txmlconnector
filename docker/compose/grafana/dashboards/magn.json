{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": "-- Grafana --",
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "target": {
          "limit": 100,
          "matchAny": false,
          "tags": [],
          "type": "dashboard"
        },
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": 2,
  "iteration": 1639318999676,
  "links": [],
  "liveNow": false,
  "panels": [
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "id": 6,
      "panels": [],
      "title": "TRANSAQ",
      "type": "row"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "HRC FOB CHINA"
            },
            "properties": [
              {
                "id": "unit",
                "value": "currencyUSD"
              },
              {
                "id": "custom.lineStyle",
                "value": {
                  "dash": [
                    10,
                    10
                  ],
                  "fill": "dash"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 10,
        "w": 24,
        "x": 0,
        "y": 1
      },
      "id": 2,
      "maxDataPoints": 80,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "database": "default",
          "dateColDataType": "",
          "dateLoading": false,
          "dateTimeColDataType": "date",
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    toStartOfInterval(date, INTERVAL 7 day) as t,\n    avgWeighted(close, volume) as price\nFROM $table\nWHERE\n    date >= toDate($from) AND date <= toDate($to)\n    and sec_code == 'MAGN'\nGROUP BY t\nORDER BY t",
          "queryType": "randomWalk",
          "rawQuery": "SELECT\n    toStartOfInterval(date, INTERVAL 7 day) as t,\n    avgWeighted(close, volume) as price\nFROM default.candles\nWHERE\n    date >= toDate(1597650015) AND date <= toDate(1637134815)\n    and sec_code == 'MAGN'\nGROUP BY t\nORDER BY t",
          "refId": "close",
          "round": "0s",
          "skip_comments": true,
          "table": "candles",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "date",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    toStartOfInterval(date, INTERVAL 7 day) as t,\n    avg(close) as \"HRC FOB CHINA\"\nFROM $table\nWHERE date >= toDate($from) AND date <= toDate($to) and code == 'MHCc1'\nGROUP BY t\nORDER BY t",
          "rawQuery": "SELECT\n    toStartOfInterval(date, INTERVAL 7 day) as t,\n    avg(close) as \"HRC FOB CHINA\"\nFROM default.stock_prices\nWHERE date >= toDate(1597650015) AND date <= toDate(1637134815) and code == 'MHCc1'\nGROUP BY t\nORDER BY t",
          "refId": "A",
          "round": "0s",
          "skip_comments": true,
          "table": "stock_prices",
          "tableLoading": false
        }
      ],
      "title": "Price History",
      "transformations": [
        {
          "id": "filterByRefId",
          "options": {}
        }
      ],
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "short"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Stock price"
            },
            "properties": [
              {
                "id": "unit",
                "value": "currencyRUB"
              },
              {
                "id": "custom.lineStyle",
                "value": {
                  "dash": [
                    10,
                    10
                  ],
                  "fill": "dash"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 10,
        "w": 24,
        "x": 0,
        "y": 11
      },
      "id": 34,
      "maxDataPoints": 80,
      "options": {
        "legend": {
          "calcs": [
            "mean"
          ],
          "displayMode": "table",
          "placement": "right"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "select q, (max(price)*11174.33)/(sum(value)*73) as \"4Q EV/EBITDA\" \n  FROM (select p.q, p.price, t.value FROM (\n    SELECT toDate(toStartOfQuarter(date_add(day, 44 , date))) as q, avgWeighted(close, volume) as price\n      FROM candles\n      WHERE sec_code == 'MAGN' and period == 5\n      GROUP BY q) as p\n    LEFT JOIN $table as t ON p.q == t.quarter\n  WHERE t.indicator == 'EBITDA' and t.sec_code == 'MAGN'\n  UNION ALL (SELECT toDate(toStartOfQuarter(date_add(quarter, 1, $dateCol))) as q, 0 as price, last_value(value) as value FROM $table WHERE sec_code == 'MAGN' GROUP BY q)\n  UNION ALL (SELECT toDate(toStartOfQuarter(date_add(quarter, 2, $dateCol))) as q, 0 as price, last_value(value) as value FROM $table WHERE sec_code == 'MAGN' GROUP BY q)\n  UNION ALL (SELECT toDate(toStartOfQuarter(date_add(quarter, 3, $dateCol))) as q, 0 as price, last_value(value) as value FROM $table WHERE sec_code == 'MAGN' GROUP BY q)\n  UNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , $forecast_price as price, 1358)\n  )\nGROUP BY q\nORDER by q",
          "rawQuery": "select q, (max(price)*11174.33)/(sum(value)*73) as \"4Q EV/EBITDA\" \n  FROM (select p.q, p.price, t.value FROM (\n    SELECT toDate(toStartOfQuarter(date_add(day, 44 , date))) as q, avgWeighted(close, volume) as price\n      FROM candles\n      WHERE sec_code == 'MAGN' and period == 5\n      GROUP BY q) as p\n    LEFT JOIN default.financial_highlights as t ON p.q == t.quarter\n  WHERE t.indicator == 'EBITDA' and t.sec_code == 'MAGN'\n  UNION ALL (SELECT toDate(toStartOfQuarter(date_add(quarter, 1, quarter))) as q, 0 as price, last_value(value) as value FROM default.financial_highlights WHERE sec_code == 'MAGN' GROUP BY q)\n  UNION ALL (SELECT toDate(toStartOfQuarter(date_add(quarter, 2, quarter))) as q, 0 as price, last_value(value) as value FROM default.financial_highlights WHERE sec_code == 'MAGN' GROUP BY q)\n  UNION ALL (SELECT toDate(toStartOfQuarter(date_add(quarter, 3, quarter))) as q, 0 as price, last_value(value) as value FROM default.financial_highlights WHERE sec_code == 'MAGN' GROUP BY q)\n  UNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , 69 as price, 1358)\n  )\nGROUP BY q\nORDER by q",
          "refId": "B",
          "round": "0s",
          "skip_comments": true,
          "table": "financial_highlights",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "select * from (select p.q, (p.price*11174.33)/((t.value*73)*4) as \"1Q EV/EBITDA\" FROM (\nSELECT\n    toDate(toStartOfQuarter(date_add(day, 44 , date))) as q,\n    avgWeighted(close, volume) as price\nFROM candles\nWHERE sec_code == 'MAGN' and period == 5\nGROUP BY q) as p\nLEFT JOIN $table as t ON p.q == t.quarter\nWHERE t.indicator == 'EBITDA' and t.sec_code == 'MAGN'\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , $forecast_price*11174.33/(1358*73*4)))\nORDER by q",
          "rawQuery": "select * from (select p.q, (p.price*11174.33)/((t.value*73)*4) as \"1Q EV/EBITDA\" FROM (\nSELECT\n    toDate(toStartOfQuarter(date_add(day, 44 , date))) as q,\n    avgWeighted(close, volume) as price\nFROM candles\nWHERE sec_code == 'MAGN' and period == 5\nGROUP BY q) as p\nLEFT JOIN default.financial_highlights as t ON p.q == t.quarter\nWHERE t.indicator == 'EBITDA' and t.sec_code == 'MAGN'\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , 69*11174.33/(1358*73*4)))\nORDER by q",
          "refId": "A",
          "round": "0s",
          "skip_comments": true,
          "table": "financial_highlights",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "",
          "dateLoading": false,
          "dateTimeColDataType": "date",
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "select * FROM (SELECT\n    toDate(toStartOfQuarter(date_add(day, 44 , date))) as q,\n    avgWeighted(close, volume) as \"Stock price\"\nFROM $table\nWHERE\n    $timeFilter\n    and sec_code == 'MAGN' and period == 5\nGROUP BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , $forecast_price))\nORDER BY q",
          "queryType": "randomWalk",
          "rawQuery": "select * FROM (SELECT\n    toDate(toStartOfQuarter(date_add(day, 44 , date))) as q,\n    avgWeighted(close, volume) as \"Stock price\"\nFROM default.candles\nWHERE\n    date >= toDateTime(1521214214) AND date <= toDateTime(1637076614)\n    and sec_code == 'MAGN' and period == 5\nGROUP BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , 69))\nORDER BY q",
          "refId": "close",
          "round": "0s",
          "skip_comments": true,
          "table": "candles",
          "tableLoading": false
        }
      ],
      "title": "Price History",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 21
      },
      "id": 4,
      "panels": [],
      "title": "HIGHLIGHTS",
      "type": "row"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "left",
            "axisSoftMin": 0,
            "fillOpacity": 80,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineWidth": 1
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "CAPEX"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "red",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "EBITDA"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "green",
                  "mode": "fixed"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 13,
        "w": 24,
        "x": 0,
        "y": 22
      },
      "id": 8,
      "options": {
        "barWidth": 1,
        "groupWidth": 0.95,
        "legend": {
          "calcs": [
            "last",
            "mean",
            "min"
          ],
          "displayMode": "list",
          "placement": "bottom"
        },
        "orientation": "auto",
        "showValue": "auto",
        "stacking": "none",
        "text": {
          "valueSize": 22
        },
        "tooltip": {
          "mode": "single"
        },
        "xTickLabelRotation": 0
      },
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "table",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "intervalFactor": 1,
          "query": "select quarter_name, CAPEX, EBITDA, Revenue from (select $dateCol as q,\n       last_value(multiIf(equals(indicator,'CAPEX'), value, NULL)) as CAPEX,\n       last_value(multiIf(equals(indicator,'EBITDA'), value, NULL)) as EBITDA,\n       last_value(multiIf(equals(indicator,'Revenue'), value, NULL)) as Revenue,\n       quarter_name\n       \nfrom $table where sec_code == 'MAGN' and $dateCol >= toDate($from) and $dateCol <= toDate($to)\ngroup by quarter_name, $dateCol\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , -250, 1291, 2918, 'Q3 2021' as quarter_name)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 6, now()))) as q , -250, 1072, 2720, 'Q4 2021' as quarter_name)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 9, now()))) as q , -250, 900, 2500, 'Q1 2022' as quarter_name)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 9, now()))) as q , -200, 850, 2200, 'Q2 2022' as quarter_name)\n)\norder by q\n",
          "queryType": "randomWalk",
          "rawQuery": "select quarter_name, CAPEX, EBITDA, Revenue from (select quarter as q,\n       last_value(multiIf(equals(indicator,'CAPEX'), value, NULL)) as CAPEX,\n       last_value(multiIf(equals(indicator,'EBITDA'), value, NULL)) as EBITDA,\n       last_value(multiIf(equals(indicator,'Revenue'), value, NULL)) as Revenue,\n       quarter_name\n       \nfrom default.financial_highlights where sec_code == 'MAGN' and quarter >= toDate(1523563942) and quarter <= toDate(1642018342)\ngroup by quarter_name, quarter\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , -250, 1291, 2918, 'Q3 2021' as quarter_name)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 6, now()))) as q , -250, 1072, 2720, 'Q4 2021' as quarter_name)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 9, now()))) as q , -250, 900, 2500, 'Q1 2022' as quarter_name)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 9, now()))) as q , -200, 850, 2200, 'Q2 2022' as quarter_name)\n)\norder by q",
          "refId": "A",
          "round": "0s",
          "skip_comments": true,
          "table": "financial_highlights",
          "tableLoading": false
        }
      ],
      "title": "Динамика Выручки и EBITDA",
      "transformations": [],
      "type": "barchart"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "left",
            "axisSoftMin": 0,
            "fillOpacity": 80,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineWidth": 1
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "CAPEX"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "red",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "EBITDA"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "green",
                  "mode": "fixed"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 35
      },
      "id": 9,
      "options": {
        "barWidth": 1,
        "groupWidth": 0.96,
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom"
        },
        "orientation": "auto",
        "showValue": "always",
        "stacking": "none",
        "text": {},
        "tooltip": {
          "mode": "single"
        },
        "xTickLabelRotation": 0
      },
      "targets": [
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "table",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "intervalFactor": 1,
          "query": "select quarter_name,\n       last_value(multiIf(equals(indicator,'Free-cash flow (FCF)'), value, NULL)) as FCF,\n       last_value(multiIf(equals(indicator,'Dividends paid'), value, NULL)) as Dividends\nfrom $table a where sec_code == 'MAGN' and $dateCol >= toDate($from) and $dateCol <= toDate($to)\ngroup by quarter_name,$dateCol\norder by $dateCol\n\n\n",
          "queryType": "randomWalk",
          "rawQuery": "select quarter_name,\n       last_value(multiIf(equals(indicator,'Free-cash flow (FCF)'), value, NULL)) as FCF,\n       last_value(multiIf(equals(indicator,'Dividends paid'), value, NULL)) as Dividends\nfrom default.financial_highlights a where sec_code == 'MAGN' and quarter >= toDate(1521186108) and quarter <= toDate(1637048508)\ngroup by quarter_name,quarter\norder by quarter",
          "refId": "A",
          "round": "0s",
          "skip_comments": true,
          "table": "financial_highlights",
          "tableLoading": false
        }
      ],
      "title": "Динамика Свободного денежного потока",
      "transformations": [],
      "type": "barchart"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "masst"
        },
        "overrides": [
          {
            "__systemRef": "hideSeriesFrom",
            "matcher": {
              "id": "byNames",
              "options": {
                "mode": "exclude",
                "names": [
                  "Premium products"
                ],
                "prefix": "All except:",
                "readOnly": true
              }
            },
            "properties": [
              {
                "id": "custom.hideFrom",
                "value": {
                  "legend": false,
                  "tooltip": false,
                  "viz": true
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 43
      },
      "id": 27,
      "options": {
        "legend": {
          "calcs": [
            "last",
            "mean"
          ],
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    $dateCol as q,\n    production as p,\n    last_value(value) as v\nFROM $table\nWHERE sec_code == 'MAGN' and $dateCol >= toDate($from) and $dateCol <= toDate($to) and has(array('Iron ore production', 'Crude steel production', 'Coking coal concentrate production', 'Pig iron production'), p) == 1\nGROUP BY q, p\nORDER BY q\n",
          "queryType": "randomWalk",
          "rawQuery": "SELECT\n    quarter as q,\n    production as p,\n    last_value(value) as v\nFROM default.productions\nWHERE sec_code == 'MAGN' and quarter >= toDate(1526137605) and quarter <= toDate(1634051205) and has(array('Iron ore production', 'Crude steel production', 'Coking coal concentrate production', 'Pig iron production'), p) == 1\nGROUP BY q, p\nORDER BY q",
          "refId": "B",
          "round": "0s",
          "skip_comments": true,
          "table": "productions",
          "tableLoading": false
        }
      ],
      "title": "Производственные показатели консолидированные,  тыс. тон",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "masst"
        },
        "overrides": [
          {
            "__systemRef": "hideSeriesFrom",
            "matcher": {
              "id": "byNames",
              "options": {
                "mode": "exclude",
                "names": [
                  "Premium products"
                ],
                "prefix": "All except:",
                "readOnly": true
              }
            },
            "properties": [
              {
                "id": "custom.hideFrom",
                "value": {
                  "legend": false,
                  "tooltip": false,
                  "viz": true
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 51
      },
      "id": 39,
      "options": {
        "legend": {
          "calcs": [
            "last",
            "mean"
          ],
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "select q, sum(v) as \"Premium products\" FROM (\nSELECT\n    $dateCol as q,\n    production as p,\n    last_value(value) as v,\n    division\nFROM $table\nWHERE sec_code == 'MAGN' and $dateCol >= toDate($from) and $dateCol <= toDate($to) and has(array('Premium products, of which', 'Premium products'), p) == 1\nGROUP BY q, p, division)\nGROUP BY q\nORDER BY q\n",
          "queryType": "randomWalk",
          "rawQuery": "select q, sum(v) as \"Premium products\" FROM (\nSELECT\n    quarter as q,\n    production as p,\n    last_value(value) as v,\n    division\nFROM default.productions\nWHERE sec_code == 'MAGN' and quarter >= toDate(1526139180) and quarter <= toDate(1634052780) and has(array('Premium products, of which', 'Premium products'), p) == 1\nGROUP BY q, p, division)\nGROUP BY q\nORDER BY q",
          "refId": "B",
          "round": "0s",
          "skip_comments": true,
          "table": "productions",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "select q, p, sum(v) FROM (\nSELECT\n    $dateCol as q,\n    production as p,\n    last_value(value) as v,\n    division\nFROM $table\nWHERE sec_code == 'MAGN' and $dateCol >= toDate($from) and $dateCol <= toDate($to) and has(array('Pig iron', 'Crude steel', 'Finished products, incl.'), p) == 1\nGROUP BY q, p, division)\nGROUP BY q, p\nORDER BY q\n",
          "queryType": "randomWalk",
          "rawQuery": "select q, p, sum(v) FROM (\nSELECT\n    quarter as q,\n    production as p,\n    last_value(value) as v,\n    division\nFROM default.productions\nWHERE sec_code == 'MAGN' and quarter >= toDate(1526139180) and quarter <= toDate(1634052780) and has(array('Pig iron', 'Crude steel', 'Finished products, incl.'), p) == 1\nGROUP BY q, p, division)\nGROUP BY q, p\nORDER BY q",
          "refId": "A",
          "round": "0s",
          "skip_comments": true,
          "table": "productions",
          "tableLoading": false
        }
      ],
      "title": "Производственные показатели,  тыс. тон",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "masst"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Loading RZD avg"
            },
            "properties": [
              {
                "id": "custom.lineStyle",
                "value": {
                  "dash": [
                    10,
                    10
                  ],
                  "fill": "dash"
                }
              },
              {
                "id": "custom.lineWidth",
                "value": 1
              }
            ]
          },
          {
            "matcher": {
              "id": "byRegexp",
              "options": "Loading.*"
            },
            "properties": [
              {
                "id": "custom.lineStyle",
                "value": {
                  "dash": [
                    10,
                    10
                  ],
                  "fill": "dash"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 59
      },
      "id": 33,
      "options": {
        "legend": {
          "calcs": [
            "last",
            "mean"
          ],
          "displayMode": "table",
          "placement": "right"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "month",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "select t, avg(LoadingRZD*1000) as \"Loading yuzd avg\" FROM (SELECT $dateCol as t, last_value(value) as LoadingRZD FROM $table WHERE name == 'yuzd' GROUP BY t\nUNION ALL (SELECT toDate(toStartOfMonth(date_add(month, -1, $dateCol))) as t, last_value(value) as LoadingRZD FROM $table WHERE name == 'yuzd' GROUP BY t))\nGROUP BY t\nORDER BY t\n",
          "rawQuery": "select t, avg(LoadingRZD*1000) as \"Loading yuzd avg\" FROM (SELECT month as t, last_value(value) as LoadingRZD FROM default.loading_rzd WHERE name == 'yuzd' GROUP BY t\nUNION ALL (SELECT toDate(toStartOfMonth(date_add(month, -1, month))) as t, last_value(value) as LoadingRZD FROM default.loading_rzd WHERE name == 'yuzd' GROUP BY t))\nGROUP BY t\nORDER BY t",
          "refId": "C",
          "round": "0s",
          "skip_comments": true,
          "table": "loading_rzd",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "month",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": true,
          "intervalFactor": 1,
          "query": "SELECT\n    $dateCol as t,\n    last_value(value)*1000 as \"Loading RZD last\"\nFROM $table WHERE name == 'chel'\nGROUP BY t\nORDER BY t\n",
          "rawQuery": "SELECT\n    month as t,\n    last_value(value)*1000 as \"Loading RZD last\"\nFROM default.loading_rzd WHERE name == 'chel'\nGROUP BY t\nORDER BY t",
          "refId": "D",
          "round": "0s",
          "skip_comments": true,
          "table": "loading_rzd",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "select q,p,last_value(v) FROM (SELECT\n    $dateCol as q,\n    product as p,\n    last_value(value) as v\nFROM $table\nWHERE has(array('Premium products', 'Flat hot-rolled products', 'Long products'), p) == 1 and sec_code == 'MAGN'\nGROUP BY q, p\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , 'Long products' as p, 270 as value)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , 'Premium products' as p, 1300 as value)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , 'Flat hot-rolled products' as p, 1658 as value)\n)\nGROUP BY q,p\nORDER BY q",
          "queryType": "randomWalk",
          "rawQuery": "select q,p,last_value(v) FROM (SELECT\n    quarter as q,\n    product as p,\n    last_value(value) as v\nFROM default.consolidated_sales_for_products\nWHERE has(array('Premium products', 'Flat hot-rolled products', 'Long products'), p) == 1 and sec_code == 'MAGN'\nGROUP BY q, p\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , 'Long products' as p, 270 as value)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , 'Premium products' as p, 1300 as value)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , 'Flat hot-rolled products' as p, 1658 as value)\n)\nGROUP BY q,p\nORDER BY q",
          "refId": "B",
          "round": "0s",
          "skip_comments": true,
          "table": "consolidated_sales_for_products",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    $dateCol as q,\n    last_value(inv.value)*1000/last_value(prices.price)/4 as \"Inventories in HRC\"\nFROM $table as inv\nLEFT JOIN prices_for_products as prices ON prices.quarter == inv.quarter\nWHERE inv.indicator == 'Inventories' and prices.product == 'Flat hot-rolled products' and inv.sec_code == 'MAGN'\nGROUP BY q\nORDER BY q\n",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(inv.value)*1000/last_value(prices.price)/4 as \"Inventories in HRC\"\nFROM default.financial_ratios as inv\nLEFT JOIN prices_for_products as prices ON prices.quarter == inv.quarter\nWHERE inv.indicator == 'Inventories' and prices.product == 'Flat hot-rolled products' and inv.sec_code == 'MAGN'\nGROUP BY q\nORDER BY q",
          "refId": "A",
          "round": "0s",
          "skip_comments": true,
          "table": "financial_ratios",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "month",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "select t, avg(LoadingRZD*1000) as \"Loading chelzd avg\" FROM (SELECT $dateCol as t, last_value(value) as LoadingRZD FROM $table WHERE name == 'chel' GROUP BY t\nUNION ALL (SELECT toDate(toStartOfMonth(date_add(month, -1, $dateCol))) as t, last_value(value) as LoadingRZD FROM $table WHERE name == 'chel' GROUP BY t))\nGROUP BY t\nORDER BY t\n",
          "rawQuery": "select t, avg(LoadingRZD*1000) as \"Loading chelzd avg\" FROM (SELECT month as t, last_value(value) as LoadingRZD FROM default.loading_rzd WHERE name == 'chel' GROUP BY t\nUNION ALL (SELECT toDate(toStartOfMonth(date_add(month, -1, month))) as t, last_value(value) as LoadingRZD FROM default.loading_rzd WHERE name == 'chel' GROUP BY t))\nGROUP BY t\nORDER BY t",
          "refId": "E",
          "round": "0s",
          "skip_comments": true,
          "table": "loading_rzd",
          "tableLoading": false
        }
      ],
      "title": "Консолидированные продажи по видам продукции,  тыс. тон",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "line"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 0
              }
            ]
          },
          "unit": "masst"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "waste steel"
            },
            "properties": [
              {
                "id": "unit",
                "value": "percentunit"
              }
            ]
          },
          {
            "__systemRef": "hideSeriesFrom",
            "matcher": {
              "id": "byNames",
              "options": {
                "mode": "exclude",
                "names": [
                  "crude steel - sales products"
                ],
                "prefix": "All except:",
                "readOnly": true
              }
            },
            "properties": [
              {
                "id": "custom.hideFrom",
                "value": {
                  "legend": false,
                  "tooltip": false,
                  "viz": true
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 67
      },
      "id": 35,
      "options": {
        "legend": {
          "calcs": [
            "last",
            "mean",
            "sum"
          ],
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    sales.quarter as q,\n    last_value(prod_mmk.value) - last_value(sales.value)*1.103 as \"crude steel - sales products\"\nFROM $table as sales\nLEFT JOIN productions as prod_mmk ON sales.quarter == prod_mmk.quarter and sales.sec_code == prod_mmk.sec_code\nWHERE sales.product == 'Sales of finished products' and sales.sec_code == 'MAGN' \nand prod_mmk.production = 'Crude steel' and prod_mmk.division = 'PJSC MMK PRODUCTION' \nGROUP BY q\nORDER BY q",
          "queryType": "randomWalk",
          "rawQuery": "SELECT\n    sales.quarter as q,\n    last_value(prod_mmk.value) - last_value(sales.value)*1.103 as \"crude steel - sales products\"\nFROM default.consolidated_sales_for_products as sales\nLEFT JOIN productions as prod_mmk ON sales.quarter == prod_mmk.quarter and sales.sec_code == prod_mmk.sec_code\nWHERE sales.product == 'Sales of finished products' and sales.sec_code == 'MAGN' \nand prod_mmk.production = 'Crude steel' and prod_mmk.division = 'PJSC MMK PRODUCTION' \nGROUP BY q\nORDER BY q",
          "refId": "D",
          "round": "0s",
          "skip_comments": true,
          "table": "consolidated_sales_for_products",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    sales.quarter as q,\n    last_value(prod_mmk.value) + last_value(prod_tur.value) - last_value(sales.value) + last_value(sales_int.value) as \"not sales finished products\"\nFROM $table as sales\nLEFT JOIN productions as prod_mmk ON sales.quarter == prod_mmk.quarter and sales.sec_code == prod_mmk.sec_code\nLEFT JOIN productions as prod_tur ON sales.quarter == prod_tur.quarter and sales.sec_code == prod_tur.sec_code and prod_tur.production == prod_mmk.production\nLEFT JOIN operational_highlights as sales_int ON sales.quarter == sales_int.quarter and sales.sec_code == sales_int.sec_code\nWHERE sales.product == 'Sales of finished products' and sales.sec_code == 'MAGN' \nand prod_mmk.production = 'Finished products, incl.' and prod_mmk.division = 'PJSC MMK PRODUCTION'and sales_int.product = 'Intersegment sales'\nand prod_tur.division = 'MMK METALURJI (STEEL TURKEY) PRODUCTION'\nGROUP BY q\nORDER BY q",
          "queryType": "randomWalk",
          "rawQuery": "SELECT\n    sales.quarter as q,\n    last_value(prod_mmk.value) + last_value(prod_tur.value) - last_value(sales.value) + last_value(sales_int.value) as \"not sales finished products\"\nFROM default.consolidated_sales_for_products as sales\nLEFT JOIN productions as prod_mmk ON sales.quarter == prod_mmk.quarter and sales.sec_code == prod_mmk.sec_code\nLEFT JOIN productions as prod_tur ON sales.quarter == prod_tur.quarter and sales.sec_code == prod_tur.sec_code and prod_tur.production == prod_mmk.production\nLEFT JOIN operational_highlights as sales_int ON sales.quarter == sales_int.quarter and sales.sec_code == sales_int.sec_code\nWHERE sales.product == 'Sales of finished products' and sales.sec_code == 'MAGN' \nand prod_mmk.production = 'Finished products, incl.' and prod_mmk.division = 'PJSC MMK PRODUCTION'and sales_int.product = 'Intersegment sales'\nand prod_tur.division = 'MMK METALURJI (STEEL TURKEY) PRODUCTION'\nGROUP BY q\nORDER BY q",
          "refId": "B",
          "round": "0s",
          "skip_comments": true,
          "table": "consolidated_sales_for_products",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": true,
          "intervalFactor": 1,
          "query": "SELECT\n    prod.quarter,\n    last_value(prod_mmk.value) - last_value(prod.value)*1.11 as \"not productions crude steel\"\nFROM productions as prod\nLEFT JOIN productions as prod_mmk ON prod.quarter == prod_mmk.quarter and prod.sec_code == prod_mmk.sec_code\nWHERE prod.production = 'Finished products, incl.' and prod.sec_code = 'MAGN' and prod.division = 'PJSC MMK PRODUCTION' \nand prod_mmk.production = 'Crude steel' and prod_mmk.division = 'PJSC MMK PRODUCTION' \nGROUP BY prod.quarter\nORDER BY prod.quarter",
          "queryType": "randomWalk",
          "rawQuery": "SELECT\n    prod.quarter,\n    last_value(prod_mmk.value) - last_value(prod.value)*1.11 as \"not productions crude steel\"\nFROM productions as prod\nLEFT JOIN productions as prod_mmk ON prod.quarter == prod_mmk.quarter and prod.sec_code == prod_mmk.sec_code\nWHERE prod.production = 'Finished products, incl.' and prod.sec_code = 'MAGN' and prod.division = 'PJSC MMK PRODUCTION' \nand prod_mmk.production = 'Crude steel' and prod_mmk.division = 'PJSC MMK PRODUCTION' \nGROUP BY prod.quarter\nORDER BY prod.quarter",
          "refId": "C",
          "round": "0s",
          "skip_comments": true,
          "table": "consolidated_sales_for_products",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    $dateCol as q,\n    last_value(inv.value)*1000/last_value(prices.price)/4 as \"Inventories in HRC\"\nFROM $table as inv\nLEFT JOIN prices_for_products as prices ON prices.quarter == inv.quarter\nWHERE inv.indicator == 'Inventories' and prices.product == 'Flat hot-rolled products' and inv.sec_code == 'MAGN'\nGROUP BY q\nORDER BY q\n",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(inv.value)*1000/last_value(prices.price)/4 as \"Inventories in HRC\"\nFROM default.financial_ratios as inv\nLEFT JOIN prices_for_products as prices ON prices.quarter == inv.quarter\nWHERE inv.indicator == 'Inventories' and prices.product == 'Flat hot-rolled products' and inv.sec_code == 'MAGN'\nGROUP BY q\nORDER BY q",
          "refId": "A",
          "round": "0s",
          "skip_comments": true,
          "table": "financial_ratios",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": true,
          "intervalFactor": 1,
          "query": "SELECT\n    prod.quarter,\n    (1-last_value(prod.value)/last_value(prod_mmk.value)) as \"waste steel\"\nFROM productions as prod\nLEFT JOIN productions as prod_mmk ON prod.quarter == prod_mmk.quarter and prod.sec_code == prod_mmk.sec_code\nWHERE prod.production = 'Finished products, incl.' and prod.sec_code = 'MAGN' and prod.division = 'PJSC MMK PRODUCTION' \nand prod_mmk.production = 'Crude steel' and prod_mmk.division = 'PJSC MMK PRODUCTION'\nGROUP BY prod.quarter\nORDER BY prod.quarter",
          "queryType": "randomWalk",
          "rawQuery": "SELECT\n    prod.quarter,\n    (1-last_value(prod.value)/last_value(prod_mmk.value)) as \"waste steel\"\nFROM productions as prod\nLEFT JOIN productions as prod_mmk ON prod.quarter == prod_mmk.quarter and prod.sec_code == prod_mmk.sec_code\nWHERE prod.production = 'Finished products, incl.' and prod.sec_code = 'MAGN' and prod.division = 'PJSC MMK PRODUCTION' \nand prod_mmk.production = 'Crude steel' and prod_mmk.division = 'PJSC MMK PRODUCTION' \nGROUP BY prod.quarter\nORDER BY prod.quarter",
          "refId": "E",
          "round": "0s",
          "skip_comments": true,
          "table": "consolidated_sales_for_products",
          "tableLoading": false
        }
      ],
      "title": "Разница между консолидированными продажами и производством сырой стали  ,  тыс. тон",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Stock price"
            },
            "properties": [
              {
                "id": "custom.lineStyle",
                "value": {
                  "dash": [
                    10,
                    10
                  ],
                  "fill": "dash"
                }
              },
              {
                "id": "unit",
                "value": "short"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 75
      },
      "id": 32,
      "options": {
        "legend": {
          "calcs": [
            "last",
            "mean"
          ],
          "displayMode": "table",
          "placement": "right"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT * FROM (SELECT\n    $dateCol as q,\n    last_value(value) as \"EBITDA per tonne\"\nFROM $table\nWHERE indicator == 'EBITDA per tonne* (USD/t)'\nGROUP BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , 381.4))\nORDER BY q",
          "queryType": "randomWalk",
          "rawQuery": "SELECT * FROM (SELECT\n    quarter as q,\n    last_value(value) as \"EBITDA per tonne\"\nFROM default.financial_ratios\nWHERE indicator == 'EBITDA per tonne* (USD/t)'\nGROUP BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , 381.4))\nORDER BY q",
          "refId": "B",
          "round": "0s",
          "skip_comments": true,
          "table": "financial_ratios",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    $dateCol as q,\n    last_value(value) as \"Slab Cash cost\"\nFROM $table\nWHERE indicator == 'Slab Cash cost (USD/t)'\nGROUP BY q\nORDER BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , $forecast_Slab)",
          "queryType": "randomWalk",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(value) as \"Slab Cash cost\"\nFROM default.financial_ratios\nWHERE indicator == 'Slab Cash cost (USD/t)'\nGROUP BY q\nORDER BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , 372.6)",
          "refId": "A",
          "round": "0s",
          "skip_comments": true,
          "table": "financial_ratios",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT * FROM (SELECT\n    $dateCol as q,\n    last_value(price) as ConsolidateWeightedAverage\nFROM $table\nWHERE product == 'Sales of finished products'\nGROUP BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , $forecast_PriceAverage))\nORDER BY q\n",
          "rawQuery": "SELECT * FROM (SELECT\n    quarter as q,\n    last_value(price) as ConsolidateWeightedAverage\nFROM default.consolidated_prices_for_products\nWHERE product == 'Sales of finished products'\nGROUP BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , 965))\nORDER BY q",
          "refId": "C",
          "round": "0s",
          "skip_comments": true,
          "table": "consolidated_prices_for_products",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT * FROM (\nSELECT p.quarter, last_value(p.price) - last_value(e.value) - last_value(s.value) as \"Other production\"\nFROM consolidated_prices_for_products as p\nLEFT JOIN financial_ratios as e on e.quarter == p.quarter and e.sec_code == p.sec_code\nLEFT JOIN financial_ratios as s on s.quarter == p.quarter and s.sec_code == p.sec_code\nWHERE p.sec_code == 'MAGN' and p.product == 'Sales of finished products' and e.indicator == 'EBITDA per tonne* (USD/t)' and s.indicator == 'Slab Cash cost (USD/t)'\nGROUP BY p.quarter\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , 211))\nORDER BY p.quarter",
          "rawQuery": "SELECT * FROM (\nSELECT p.quarter, last_value(p.price) - last_value(e.value) - last_value(s.value) as \"Other production\"\nFROM consolidated_prices_for_products as p\nLEFT JOIN financial_ratios as e on e.quarter == p.quarter and e.sec_code == p.sec_code\nLEFT JOIN financial_ratios as s on s.quarter == p.quarter and s.sec_code == p.sec_code\nWHERE p.sec_code == 'MAGN' and p.product == 'Sales of finished products' and e.indicator == 'EBITDA per tonne* (USD/t)' and s.indicator == 'Slab Cash cost (USD/t)'\nGROUP BY p.quarter\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , 211))\nORDER BY p.quarter",
          "refId": "D",
          "round": "0s",
          "skip_comments": true,
          "table": "consolidated_prices_for_products",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "",
          "dateLoading": false,
          "dateTimeColDataType": "date",
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": true,
          "intervalFactor": 1,
          "query": "SELECT\n    toDate(toStartOfQuarter(date_add(day, 44 , date))) as q,\n    avgWeighted(close, volume) as \"Stock price\"\nFROM $table\nWHERE\n    $timeFilter\n    and sec_code == 'MAGN' and period == 5\nGROUP BY q\nORDER BY q",
          "rawQuery": "SELECT\n    toDate(toStartOfQuarter(date_add(day, 44 , date))) as q,\n    avgWeighted(close, volume) as \"Stock price\"\nFROM default.candles\nWHERE\n    date >= toDateTime(1523561690) AND date <= toDateTime(1642016090)\n    and sec_code == 'MAGN' and period == 5\nGROUP BY q\nORDER BY q",
          "refId": "E",
          "round": "0s",
          "skip_comments": true,
          "table": "candles",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "",
          "dateLoading": false,
          "dateTimeColDataType": "date",
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": true,
          "intervalFactor": 1,
          "query": "SELECT\n    toDate(toStartOfQuarter(date_add(day, 44 , date))) as q,\n    max(close) as \"Stock price\"\nFROM $table\nWHERE\n    $timeFilter\n    and sec_code == 'MAGN' and period == 5\nGROUP BY q\nORDER BY q",
          "rawQuery": "SELECT\n    toDate(toStartOfQuarter(date_add(day, 44 , date))) as q,\n    max(close) as \"Stock price\"\nFROM default.candles\nWHERE\n    date >= toDateTime(1523561691) AND date <= toDateTime(1642016091)\n    and sec_code == 'MAGN' and period == 5\nGROUP BY q\nORDER BY q",
          "refId": "F",
          "round": "0s",
          "skip_comments": true,
          "table": "candles",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "",
          "dateLoading": false,
          "dateTimeColDataType": "date",
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": true,
          "intervalFactor": 1,
          "query": "SELECT\n    toDate(toStartOfQuarter(date_add(day, 44 , date))) as q,\n    min(close) as \"Stock price\"\nFROM $table\nWHERE\n    $timeFilter\n    and sec_code == 'MAGN' and period == 5\nGROUP BY q\nORDER BY q",
          "rawQuery": "SELECT\n    toDate(toStartOfQuarter(date_add(day, 44 , date))) as q,\n    min(close) as \"Stock price\"\nFROM default.candles\nWHERE\n    date >= toDateTime(1523561693) AND date <= toDateTime(1642016093)\n    and sec_code == 'MAGN' and period == 5\nGROUP BY q\nORDER BY q",
          "refId": "G",
          "round": "0s",
          "skip_comments": true,
          "table": "candles",
          "tableLoading": false
        }
      ],
      "title": "EBITDA/т и цена реализации металлопродукции USD/т",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 83
      },
      "id": 29,
      "options": {
        "legend": {
          "calcs": [
            "last",
            "step"
          ],
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "select * FROM (\n    SELECT\n    $dateCol as q,\n    last_value(prices.price)*last_value(sales.value)/1000 as calculatedRevenue\nFROM $table as prices\nLEFT JOIN consolidated_sales_for_products as sales on (prices.sec_code == sales.sec_code and prices.quarter == sales.quarter)\nWHERE prices.product == 'Sales of finished products, including:' and sales.product == 'Sales of finished products, including:'\nGROUP BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , $forecast_PriceAverage*$forecast_sales/1000 as Revenue))\nORDER BY q\n\n",
          "rawQuery": "select * FROM (\n    SELECT\n    quarter as q,\n    last_value(prices.price)*last_value(sales.value)/1000 as calculatedRevenue\nFROM default.consolidated_prices_for_products as prices\nLEFT JOIN consolidated_sales_for_products as sales on (prices.sec_code == sales.sec_code and prices.quarter == sales.quarter)\nWHERE prices.product == 'Sales of finished products, including:' and sales.product == 'Sales of finished products, including:'\nGROUP BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , 944*3320/1000 as Revenue))\nORDER BY q",
          "refId": "C",
          "round": "0s",
          "skip_comments": true,
          "table": "consolidated_prices_for_products",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "select * FROM (SELECT\n    $dateCol as q,\n    last_value(value) as EBITDA\nFROM $table\nWHERE indicator == 'EBITDA' and sec_code == 'MAGN'\nGROUP BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , 444*$forecast_sales/1000 as EBITDA))\nORDER BY q\n",
          "rawQuery": "select * FROM (SELECT\n    quarter as q,\n    last_value(value) as EBITDA\nFROM default.financial_highlights\nWHERE indicator == 'EBITDA' and sec_code == 'MAGN'\nGROUP BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , 444*3320/1000 as EBITDA))\nORDER BY q",
          "refId": "A",
          "round": "0s",
          "skip_comments": true,
          "table": "financial_highlights",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "select * FROM (SELECT\n    $dateCol as q,\n    last_value(value) as Revenue\nFROM $table\nWHERE indicator == 'Revenue' and sec_code == 'MAGN'\nGROUP BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , $forecast_PriceAverage*$forecast_sales*1.04/1000 as Revenue))\nORDER BY q\n",
          "rawQuery": "select * FROM (SELECT\n    quarter as q,\n    last_value(value) as Revenue\nFROM default.financial_highlights\nWHERE indicator == 'Revenue' and sec_code == 'MAGN'\nGROUP BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , 944*3320*1.04/1000 as Revenue))\nORDER BY q",
          "refId": "B",
          "round": "0s",
          "skip_comments": true,
          "table": "financial_highlights",
          "tableLoading": false
        }
      ],
      "title": "Выручка расчетная и EBITDA",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 91
      },
      "id": 11,
      "panels": [],
      "title": "Production & Sales",
      "type": "row"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "__systemRef": "hideSeriesFrom",
            "matcher": {
              "id": "byNames",
              "options": {
                "mode": "exclude",
                "names": [
                  "FlatHotRolled",
                  "HRC FOB CHINA with month lag",
                  "HRC FOB CHINA avg",
                  "HRC FOB CHINA"
                ],
                "prefix": "All except:",
                "readOnly": true
              }
            },
            "properties": [
              {
                "id": "custom.hideFrom",
                "value": {
                  "legend": false,
                  "tooltip": false,
                  "viz": true
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "HRC FOB CHINA avg"
            },
            "properties": [
              {
                "id": "custom.lineStyle",
                "value": {
                  "dash": [
                    10,
                    10
                  ],
                  "fill": "dash"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "HRC FOB CHINA"
            },
            "properties": [
              {
                "id": "unit",
                "value": "short"
              },
              {
                "id": "custom.lineStyle",
                "value": {
                  "dash": [
                    0,
                    10
                  ],
                  "fill": "dot"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 92
      },
      "id": 17,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    $dateCol as q,\n    last_value(price) as FlatHotRolled\nFROM $table\nWHERE product == 'Flat hot-rolled products'\nGROUP BY q\nORDER BY q\n",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(price) as FlatHotRolled\nFROM default.prices_for_products\nWHERE product == 'Flat hot-rolled products'\nGROUP BY q\nORDER BY q",
          "refId": "B",
          "round": "0s",
          "skip_comments": true,
          "table": "prices_for_products",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "intervalFactor": 1,
          "query": "SELECT\n    $dateCol as q,\n    last_value(price) as ConsolidateWeightedAverage\nFROM $table\nWHERE product == 'Sales of finished products'\nGROUP BY q\nORDER BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , $forecast_PriceAverage)",
          "queryType": "randomWalk",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(price) as ConsolidateWeightedAverage\nFROM default.consolidated_prices_for_products\nWHERE product == 'Sales of finished products'\nGROUP BY q\nORDER BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , 980)",
          "refId": "A",
          "round": "0s",
          "skip_comments": true,
          "table": "consolidated_prices_for_products",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    $dateCol as q,\n    last_value(price) as ExportAverage\nFROM $table\nWHERE product == 'Export'\nGROUP BY q\nORDER BY q\n",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(price) as ExportAverage\nFROM default.prices_for_products\nWHERE product == 'Export'\nGROUP BY q\nORDER BY q",
          "refId": "C",
          "round": "0s",
          "skip_comments": true,
          "table": "prices_for_products",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": true,
          "intervalFactor": 1,
          "query": "SELECT\n    $dateCol as q,\n    last_value(price) as ConsolidateFlatHotRolled\nFROM $table\nWHERE product == 'Flat hot-rolled products'\nGROUP BY q\nORDER BY q",
          "queryType": "randomWalk",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(price) as ConsolidateFlatHotRolled\nFROM default.consolidated_prices_for_products\nWHERE product == 'Flat hot-rolled products'\nGROUP BY q\nORDER BY q",
          "refId": "D",
          "round": "0s",
          "skip_comments": true,
          "table": "consolidated_prices_for_products",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    toDate(toStartOfQuarter(date_add(month, $price_lag_months, date))) as q,\n    avg(close) as \"HRC FOB CHINA with month lag\"\nFROM $table\n\nWHERE code == 'MHCc1'\nGROUP BY q\nORDER BY q\n",
          "rawQuery": "SELECT\n    toDate(toStartOfQuarter(date_add(month, 4, date))) as q,\n    avg(close) as \"HRC FOB CHINA with month lag\"\nFROM default.stock_prices\n\nWHERE code == 'MHCc1'\nGROUP BY q\nORDER BY q",
          "refId": "E",
          "round": "0s",
          "skip_comments": true,
          "table": "stock_prices",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    toDate(toStartOfQuarter(date_add(month, 3, date))) as q,\n    avg(close) as \"HRC FOB CHINA avg\"\nFROM $table\n\nWHERE code == 'MHCc1'\nGROUP BY q\nORDER BY q",
          "rawQuery": "SELECT\n    toDate(toStartOfQuarter(date_add(month, 3, date))) as q,\n    avg(close) as \"HRC FOB CHINA avg\"\nFROM default.stock_prices\n\nWHERE code == 'MHCc1'\nGROUP BY q\nORDER BY q",
          "refId": "F",
          "round": "0s",
          "skip_comments": true,
          "table": "stock_prices",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "date",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    toStartOfInterval(date, INTERVAL 7 day) as t,\n    avg(close) as \"HRC FOB CHINA\"\nFROM $table\nWHERE date >= toDate($from) AND date <= toDate($to) and code == 'MHCc1' \nGROUP BY t\nORDER BY t\n",
          "rawQuery": "SELECT\n    toStartOfInterval(date, INTERVAL 7 day) as t,\n    avg(close) as \"HRC FOB CHINA\"\nFROM default.stock_prices\nWHERE date >= toDate(1552750701) AND date <= toDate(1634398701) and code == 'MHCc1' \nGROUP BY t\nORDER BY t",
          "refId": "G",
          "round": "0s",
          "skip_comments": true,
          "table": "stock_prices",
          "tableLoading": false
        }
      ],
      "title": "Цены за тонну продукции",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "masst"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 100
      },
      "id": 30,
      "options": {
        "legend": {
          "calcs": [
            "last",
            "mean"
          ],
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    $dateCol as q,\n    product,\n    last_value(value)\nFROM $table\nWHERE sec_code == 'MAGN' and has(array('Premium products','Long products', 'Flat hot-rolled products'), product) == 1\nGROUP BY q, product\nORDER BY q\n",
          "rawQuery": "SELECT\n    quarter as q,\n    product,\n    last_value(value)\nFROM default.consolidated_sales_for_products\nWHERE sec_code == 'MAGN' and has(array('Premium products','Long products', 'Flat hot-rolled products'), product) == 1\nGROUP BY q, product\nORDER BY q",
          "refId": "B",
          "round": "0s",
          "skip_comments": true,
          "table": "consolidated_sales_for_products",
          "tableLoading": false
        }
      ],
      "title": "Консолидированные продажи, ton",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "MMK HRC FOB CHINA"
            },
            "properties": [
              {
                "id": "custom.lineStyle",
                "value": {
                  "dash": [
                    10,
                    10
                  ],
                  "fill": "dash"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 108
      },
      "id": 31,
      "options": {
        "legend": {
          "calcs": [
            "last",
            "mean"
          ],
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    $dateCol as q,\n    product,\n    last_value(price)\nFROM $table\nWHERE sec_code == 'MAGN' and has(array('HVA products, including:','Long products', 'Flat hot-rolled products'), product) == 1\nGROUP BY q, product\nORDER BY q\n",
          "rawQuery": "SELECT\n    quarter as q,\n    product,\n    last_value(price)\nFROM default.consolidated_prices_for_products\nWHERE sec_code == 'MAGN' and has(array('HVA products, including:','Long products', 'Flat hot-rolled products'), product) == 1\nGROUP BY q, product\nORDER BY q",
          "refId": "B",
          "round": "0s",
          "skip_comments": true,
          "table": "consolidated_prices_for_products",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    $dateCol as q,\n    last_value(price) as \"MMK HRC FOB CHINA\"\nFROM $table\nWHERE product == 'HRC FOB CHINA'\nGROUP BY q\nORDER BY q",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(price) as \"MMK HRC FOB CHINA\"\nFROM default.fob_prices\nWHERE product == 'HRC FOB CHINA'\nGROUP BY q\nORDER BY q",
          "refId": "A",
          "round": "0s",
          "skip_comments": true,
          "table": "fob_prices",
          "tableLoading": false
        }
      ],
      "title": "Консолидированные цены продаж",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "left",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "smooth",
            "lineStyle": {
              "dash": [
                10,
                10
              ],
              "fill": "dash"
            },
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "HRC FOB CHINA"
            },
            "properties": [
              {
                "id": "custom.lineStyle",
                "value": {
                  "fill": "solid"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 116
      },
      "id": 15,
      "options": {
        "legend": {
          "calcs": [
            "last",
            "mean"
          ],
          "displayMode": "table",
          "placement": "right"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": false,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT * FROM (\nSELECT\n    $dateCol as q,\n    last_value(price) as \"HRC MMK price\"\nFROM $table\nWHERE product == 'Flat hot-rolled products' and sec_code == 'MAGN'\nGROUP BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , $forecast_PriceAverage/1.12))\nORDER BY q",
          "rawQuery": "SELECT * FROM (\nSELECT\n    quarter as q,\n    last_value(price) as \"HRC MMK price\"\nFROM default.prices_for_products\nWHERE product == 'Flat hot-rolled products' and sec_code == 'MAGN'\nGROUP BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , 965/1.12))\nORDER BY q",
          "refId": "G",
          "round": "0s",
          "skip_comments": true,
          "table": "prices_for_products",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "date",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    toDate(toStartOfQuarter(date_add(week, $price_lag_weeks, date))) as q,\n    avg(close) as \"HRC FOB CHINA\"\nFROM $table\nWHERE code == 'MHCc1'\nGROUP BY q\nORDER BY q\n",
          "queryType": "randomWalk",
          "rawQuery": "SELECT\n    toDate(toStartOfQuarter(date_add(week, 18, date))) as q,\n    avg(close) as \"HRC FOB CHINA\"\nFROM default.stock_prices\nWHERE code == 'MHCc1'\nGROUP BY q\nORDER BY q",
          "refId": "E",
          "round": "0s",
          "skip_comments": true,
          "table": "stock_prices",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "date",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": true,
          "intervalFactor": 1,
          "query": "select\n    toDate(toStartOfQuarter(date_add(month, $price_lag_months, date))) as q,\n    avg(close) as US_HRC\nfrom $table\nWHERE code == 'HRCc1'\nGROUP BY q\nORDER BY q",
          "queryType": "randomWalk",
          "rawQuery": "select\n    toDate(toStartOfQuarter(date_add(day, 71, date))) as q,\n    avg(close) as US_HRC\nfrom default.stock_prices\nWHERE code == 'HRCc1'\nGROUP BY q\nORDER BY q",
          "refId": "D",
          "round": "0s",
          "skip_comments": true,
          "table": "stock_prices",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "date",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": true,
          "intervalFactor": 1,
          "query": "select\n    toDate(toStartOfQuarter(date_add(month, $price_lag_months, date))) as q,\n    avg(M3) as LME_HC\nfrom $table\nWHERE code == 'HC'\nGROUP BY q\nORDER BY q\n",
          "queryType": "randomWalk",
          "rawQuery": "select\n    toDate(toStartOfQuarter(date_add(month, 71, date))) as q,\n    avg(M3) as LME_HC\nfrom default.lme_closing_prices\nWHERE code == 'HC'\nGROUP BY q\nORDER BY q",
          "refId": "A",
          "round": "0s",
          "skip_comments": true,
          "table": "lme_closing_prices",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "date",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": true,
          "intervalFactor": 1,
          "query": "select\n    toDate(toStartOfQuarter(date_add(month, $price_lag_months, date))) as q,\n    avg(M12) as LME_HU\nfrom $table\nWHERE code == 'HU'\nGROUP BY q\nORDER BY q\n",
          "queryType": "randomWalk",
          "rawQuery": "select\n    toDate(toStartOfQuarter(date_add(month, 71, date))) as q,\n    avg(M12) as LME_HU\nfrom default.lme_closing_prices\nWHERE code == 'HU'\nGROUP BY q\nORDER BY q",
          "refId": "B",
          "round": "0s",
          "skip_comments": true,
          "table": "lme_closing_prices",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": false,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT * FROM (\nSELECT\n    $dateCol as q,\n    last_value(price) as \"Average cons\"\nFROM $table\nWHERE product == 'Sales of finished products'\nGROUP BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , $forecast_PriceAverage))\nORDER BY q\n",
          "rawQuery": "SELECT * FROM (\nSELECT\n    quarter as q,\n    last_value(price) as \"Average cons\"\nFROM default.consolidated_prices_for_products\nWHERE product == 'Sales of finished products'\nGROUP BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , 965))\nORDER BY q",
          "refId": "C",
          "round": "0s",
          "skip_comments": true,
          "table": "consolidated_prices_for_products",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "date",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": true,
          "intervalFactor": 1,
          "query": "select\n    toDate(toStartOfQuarter(date_add(month, $price_lag_months, date))) as q,\n    avg(close)/8 as SHHCc1\nfrom $table\nWHERE code == 'SHHCc1'\nGROUP BY q\nORDER BY q",
          "queryType": "randomWalk",
          "rawQuery": "select\n    toDate(toStartOfQuarter(date_add(month, 71, date))) as q,\n    avg(close)/8 as SHHCc1\nfrom default.stock_prices\nWHERE code == 'SHHCc1'\nGROUP BY q\nORDER BY q",
          "refId": "F",
          "round": "0s",
          "skip_comments": true,
          "table": "stock_prices",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": false,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    $dateCol as q,\n    last_value(price) as \"MMK HRC FOB CHINA\"\nFROM $table\nWHERE product == 'HRC FOB CHINA'\nGROUP BY q\nORDER BY q",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(price) as \"MMK HRC FOB CHINA\"\nFROM default.fob_prices\nWHERE product == 'HRC FOB CHINA'\nGROUP BY q\nORDER BY q",
          "refId": "H",
          "round": "0s",
          "skip_comments": true,
          "table": "fob_prices",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": false,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    $dateCol as q,\n    last_value(price) as \"MMK HRC FOB BS\"\nFROM $table\nWHERE product == 'HRC FOB Black sea'\nGROUP BY q\nORDER BY q",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(price) as \"MMK HRC FOB BS\"\nFROM default.fob_prices\nWHERE product == 'HRC FOB Black sea'\nGROUP BY q\nORDER BY q",
          "refId": "I",
          "round": "0s",
          "skip_comments": true,
          "table": "fob_prices",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": false,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT * FROM (\nSELECT\n    $dateCol as q,\n    last_value(price) as \"HRC cons\"\nFROM $table\nWHERE product == 'Flat hot-rolled products'\nGROUP BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , $forecast_PriceAverage/1.12))\nORDER BY q\n",
          "rawQuery": "SELECT * FROM (\nSELECT\n    quarter as q,\n    last_value(price) as \"HRC cons\"\nFROM default.consolidated_prices_for_products\nWHERE product == 'Flat hot-rolled products'\nGROUP BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , 965/1.12))\nORDER BY q",
          "refId": "J",
          "round": "0s",
          "skip_comments": true,
          "table": "consolidated_prices_for_products",
          "tableLoading": false
        }
      ],
      "title": "Динамика цен на г/к прокат в дол. США",
      "transformations": [],
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 124
      },
      "id": 19,
      "panels": [],
      "title": "COS breakdown",
      "type": "row"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "normal"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 125
      },
      "id": 21,
      "options": {
        "legend": {
          "calcs": [
            "last",
            "mean"
          ],
          "displayMode": "table",
          "placement": "right"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    quarter as q,\n    last_value(value) as Other\nFROM $table\n\nWHERE structure == 'Other production costs' and sec_code == 'MAGN'\n\nGROUP BY q\n\nORDER BY q\n",
          "queryType": "randomWalk",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(value) as Other\nFROM default.cost_of_sales_structure\n\nWHERE structure == 'Other production costs' and sec_code == 'MAGN'\n\nGROUP BY q\n\nORDER BY q",
          "refId": "D",
          "round": "0s",
          "skip_comments": true,
          "table": "cost_of_sales_structure",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    quarter as q,\n    last_value(value) as Services\nFROM $table\n\nWHERE structure == 'Services received' and sec_code == 'MAGN'\n\nGROUP BY q\n\nORDER BY q\n",
          "queryType": "randomWalk",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(value) as Services\nFROM default.cost_of_sales_structure\n\nWHERE structure == 'Services received' and sec_code == 'MAGN'\n\nGROUP BY q\n\nORDER BY q",
          "refId": "B",
          "round": "0s",
          "skip_comments": true,
          "table": "cost_of_sales_structure",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    quarter as q,\n    last_value(value) as Depreciation\nFROM $table\n\nWHERE structure == 'Depreciation' and sec_code == 'MAGN'\n\nGROUP BY q\n\nORDER BY q\n",
          "queryType": "randomWalk",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(value) as Depreciation\nFROM default.cost_of_sales_structure\n\nWHERE structure == 'Depreciation' and sec_code == 'MAGN'\n\nGROUP BY q\n\nORDER BY q",
          "refId": "E",
          "round": "0s",
          "skip_comments": true,
          "table": "cost_of_sales_structure",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    quarter as q,\n    last_value(value) as Labour\nFROM $table\n\nWHERE structure == 'Labour costs' and sec_code == 'MAGN'\n\nGROUP BY q\n\nORDER BY q\n",
          "queryType": "randomWalk",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(value) as Labour\nFROM default.cost_of_sales_structure\n\nWHERE structure == 'Labour costs' and sec_code == 'MAGN'\n\nGROUP BY q\n\nORDER BY q",
          "refId": "C",
          "round": "0s",
          "skip_comments": true,
          "table": "cost_of_sales_structure",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "intervalFactor": 1,
          "query": "SELECT\n    quarter as q,\n    last_value(value) as Material\nFROM $table\n\nWHERE structure == 'Material costs' and sec_code == 'MAGN'\n\nGROUP BY q\n\nORDER BY q\n",
          "queryType": "randomWalk",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(value) as Material\nFROM default.cost_of_sales_structure\n\nWHERE structure == 'Material costs' and sec_code == 'MAGN'\n\nGROUP BY q\n\nORDER BY q",
          "refId": "A",
          "round": "0s",
          "skip_comments": true,
          "table": "cost_of_sales_structure",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": true,
          "intervalFactor": 1,
          "query": "SELECT\n    quarter as q,\n    last_value(value) as Total\nFROM $table\n\nWHERE structure == 'Total cost of sales' and sec_code == 'MAGN'\n\nGROUP BY q\n\nORDER BY q\n",
          "queryType": "randomWalk",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(value) as Total\nFROM default.cost_of_sales_structure\n\nWHERE structure == 'Total cost of sales' and sec_code == 'MAGN'\n\nGROUP BY q\n\nORDER BY q",
          "refId": "F",
          "round": "0s",
          "skip_comments": true,
          "table": "cost_of_sales_structure",
          "tableLoading": false
        }
      ],
      "title": "Структура затрат",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 125
      },
      "id": 23,
      "options": {
        "legend": {
          "calcs": [
            "last",
            "mean"
          ],
          "displayMode": "table",
          "placement": "right"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    quarter as q,\n    last_value(value) as Scrap\nFROM $table\nWHERE material == 'Metal scrap'\nGROUP BY q\nORDER BY q\n",
          "queryType": "randomWalk",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(value) as Scrap\nFROM default.material_cost_structure\nWHERE material == 'Metal scrap'\nGROUP BY q\nORDER BY q",
          "refId": "J",
          "round": "0s",
          "skip_comments": true,
          "table": "material_cost_structure",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    quarter as q,\n    last_value(value) as Pellets\nFROM $table\nWHERE material == 'Pellets'\nGROUP BY q\nORDER BY q\n",
          "queryType": "randomWalk",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(value) as Pellets\nFROM default.material_cost_structure\nWHERE material == 'Pellets'\nGROUP BY q\nORDER BY q",
          "refId": "F",
          "round": "0s",
          "skip_comments": true,
          "table": "material_cost_structure",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    quarter as q,\n    last_value(value) as IronOre\nFROM $table\nWHERE material == 'Iron ore & concentrate'\nGROUP BY q\nORDER BY q\n",
          "queryType": "randomWalk",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(value) as IronOre\nFROM default.material_cost_structure\nWHERE material == 'Iron ore & concentrate'\nGROUP BY q\nORDER BY q",
          "refId": "G",
          "round": "0s",
          "skip_comments": true,
          "table": "material_cost_structure",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    quarter as q,\n    last_value(value) as Coal\nFROM $table\nWHERE material == 'Coal concentrate'\nGROUP BY q\nORDER BY q\n",
          "queryType": "randomWalk",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(value) as Coal\nFROM default.material_cost_structure\nWHERE material == 'Coal concentrate'\nGROUP BY q\nORDER BY q",
          "refId": "H",
          "round": "0s",
          "skip_comments": true,
          "table": "material_cost_structure",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    quarter as q,\n    last_value(value) as Auxilary\nFROM $table\nWHERE material == 'Auxilary materials'\nGROUP BY q\nORDER BY q\n",
          "queryType": "randomWalk",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(value) as Auxilary\nFROM default.material_cost_structure\nWHERE material == 'Auxilary materials'\nGROUP BY q\nORDER BY q",
          "refId": "D",
          "round": "0s",
          "skip_comments": true,
          "table": "material_cost_structure",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    quarter as q,\n    last_value(value) as OtherMain\nFROM $table\nWHERE material == 'Other main materials'\nGROUP BY q\nORDER BY q\n",
          "queryType": "randomWalk",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(value) as OtherMain\nFROM default.material_cost_structure\nWHERE material == 'Other main materials'\nGROUP BY q\nORDER BY q",
          "refId": "E",
          "round": "0s",
          "skip_comments": true,
          "table": "material_cost_structure",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "intervalFactor": 1,
          "query": "SELECT\n    quarter as q,\n    last_value(value) as Fuel\nFROM $table\nWHERE material == 'Fuel'\nGROUP BY q\nORDER BY q, Fuel\n",
          "queryType": "randomWalk",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(value) as Fuel\nFROM default.material_cost_structure\nWHERE material == 'Fuel'\nGROUP BY q\nORDER BY q, Fuel",
          "refId": "A",
          "round": "0s",
          "skip_comments": true,
          "table": "material_cost_structure",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    quarter as q,\n    last_value(value) as Gas\nFROM $table\nWHERE material == 'Gas'\nGROUP BY q\nORDER BY q\n",
          "queryType": "randomWalk",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(value) as Gas\nFROM default.material_cost_structure\nWHERE material == 'Gas'\nGROUP BY q\nORDER BY q",
          "refId": "C",
          "round": "0s",
          "skip_comments": true,
          "table": "material_cost_structure",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    quarter as q,\n    last_value(value) as Power\nFROM $table\nWHERE material == 'Power'\nGROUP BY q\nORDER BY q\n",
          "queryType": "randomWalk",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(value) as Power\nFROM default.material_cost_structure\nWHERE material == 'Power'\nGROUP BY q\nORDER BY q",
          "refId": "B",
          "round": "0s",
          "skip_comments": true,
          "table": "material_cost_structure",
          "tableLoading": false
        }
      ],
      "title": "Затраты на материалы, USD mln",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "__systemRef": "hideSeriesFrom",
            "matcher": {
              "id": "byNames",
              "options": {
                "mode": "exclude",
                "names": [
                  "62PercFe",
                  "IronSlab"
                ],
                "prefix": "All except:",
                "readOnly": true
              }
            },
            "properties": [
              {
                "id": "custom.hideFrom",
                "value": {
                  "legend": false,
                  "tooltip": false,
                  "viz": true
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 133
      },
      "id": 25,
      "options": {
        "legend": {
          "calcs": [
            "last",
            "mean"
          ],
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "select\n    toDate(toStartOfQuarter(date_add(week, $price_lag_weeks, date))) as q,\n    avg(close) as 62PercFe\nfrom $table\nWHERE code == 'SGXIOSc1'\nGROUP BY q\nORDER BY q\n",
          "rawQuery": "select\n    toDate(toStartOfQuarter(date_add(week, 18, date))) as q,\n    avg(close) as 62PercFe\nfrom default.stock_prices\nWHERE code == 'SGXIOSc1'\nGROUP BY q\nORDER BY q",
          "refId": "B",
          "round": "0s",
          "skip_comments": true,
          "table": "stock_prices",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "select * FROM (\nSELECT q, sum(perc) as IronSlab FROM (\nSELECT\n    quarter as q,\n    last_value(slab_cash_cost_structure.value)*last_value(financial_ratios.value) as perc\nFROM slab_cash_cost_structure\n       LEFT JOIN financial_ratios ON\n           financial_ratios.quarter == slab_cash_cost_structure.quarter\n        and financial_ratios.sec_code == slab_cash_cost_structure.sec_code\nWHERE (structure == 'Pellets'\n   or structure == 'Iron ore & concentrate'\n   or structure == 'Metal scrap')\n   and indicator == 'Slab Cash cost (USD/t)'\nGROUP BY q, structure)\nGROUP BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , $forecast_IronSlab))\nORDER BY q",
          "queryType": "randomWalk",
          "rawQuery": "select * FROM (\nSELECT q, sum(perc) as IronSlab FROM (\nSELECT\n    quarter as q,\n    last_value(slab_cash_cost_structure.value)*last_value(financial_ratios.value) as perc\nFROM slab_cash_cost_structure\n       LEFT JOIN financial_ratios ON\n           financial_ratios.quarter == slab_cash_cost_structure.quarter\n        and financial_ratios.sec_code == slab_cash_cost_structure.sec_code\nWHERE (structure == 'Pellets'\n   or structure == 'Iron ore & concentrate'\n   or structure == 'Metal scrap')\n   and indicator == 'Slab Cash cost (USD/t)'\nGROUP BY q, structure)\nGROUP BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , 152))\nORDER BY q",
          "refId": "A",
          "round": "0s",
          "skip_comments": true,
          "table": "material_cost_structure",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": true,
          "intervalFactor": 1,
          "query": "SELECT\n    $dateCol as q,\n    last_value(price) as Index62Fe\nFROM $table\nWHERE product == 'Fe'\nGROUP BY q\nORDER BY q\n",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(price) as Index62Fe\nFROM default.fob_prices\nWHERE product == 'Fe'\nGROUP BY q\nORDER BY q",
          "refId": "C",
          "round": "0s",
          "skip_comments": true,
          "table": "fob_prices",
          "tableLoading": false
        }
      ],
      "title": "Корреляция индекса ЖРС и железной части кеш-кост сляба",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 133
      },
      "id": 28,
      "options": {
        "legend": {
          "calcs": [
            "last",
            "mean"
          ],
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "multi"
        }
      },
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "select\n    toDate(toStartOfQuarter(date_add(week, $price_lag_weeks, date))) as q,\n    avg(close)/17.4 as \"Coking Coal CHINA\"\nfrom $table\nWHERE code == 'DJMc1'\nGROUP BY q\nORDER BY q\n",
          "rawQuery": "select\n    toDate(toStartOfQuarter(date_add(week, 18, date))) as q,\n    avg(close)/17.4 as \"Coking Coal CHINA\"\nfrom default.stock_prices\nWHERE code == 'DJMc1'\nGROUP BY q\nORDER BY q",
          "refId": "B",
          "round": "0s",
          "skip_comments": true,
          "table": "stock_prices",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": true,
          "intervalFactor": 1,
          "query": "SELECT\n    $dateCol as q,\n    last_value(price)/3.2 as \"HCC FOB Australia\"\nFROM $table\nWHERE product == 'HCC FOB'\nGROUP BY q\nORDER BY q\n",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(price)/3.2 as \"HCC FOB Australia\"\nFROM default.fob_prices\nWHERE product == 'HCC FOB'\nGROUP BY q\nORDER BY q",
          "refId": "C",
          "round": "0s",
          "skip_comments": true,
          "table": "fob_prices",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "intervalFactor": 1,
          "query": "SELECT * FROM(\nSELECT q, sum(perc) as \"Coal in Slab\" FROM (\nSELECT\n    quarter as q,\n    last_value(slab_cash_cost_structure.value)*last_value(financial_ratios.value) as perc\nFROM slab_cash_cost_structure\n       LEFT JOIN financial_ratios ON\n           financial_ratios.quarter == slab_cash_cost_structure.quarter\n        and financial_ratios.sec_code == slab_cash_cost_structure.sec_code\nWHERE structure == 'Coal concentrate' and indicator == 'Slab Cash cost (USD/t)'\nGROUP BY q, structure)\nGROUP BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , 138))\nORDER BY q",
          "queryType": "randomWalk",
          "rawQuery": "SELECT * FROM(\nSELECT q, sum(perc) as \"Coal in Slab\" FROM (\nSELECT\n    quarter as q,\n    last_value(slab_cash_cost_structure.value)*last_value(financial_ratios.value) as perc\nFROM slab_cash_cost_structure\n       LEFT JOIN financial_ratios ON\n           financial_ratios.quarter == slab_cash_cost_structure.quarter\n        and financial_ratios.sec_code == slab_cash_cost_structure.sec_code\nWHERE structure == 'Coal concentrate' and indicator == 'Slab Cash cost (USD/t)'\nGROUP BY q, structure)\nGROUP BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , 138))\nORDER BY q",
          "refId": "A",
          "round": "0s",
          "skip_comments": true,
          "table": "material_cost_structure",
          "tableLoading": false
        }
      ],
      "title": "Корреляция индекса Фьючерс на коксующийся уголь и угля в стоимости кеш-кост сляба",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "masst"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 141
      },
      "id": 37,
      "options": {
        "legend": {
          "calcs": [
            "last",
            "mean"
          ],
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "database": "default",
          "dateColDataType": "month",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    $dateCol as q,\n    name,\n    last_value(quantity)\nFROM $table\nWHERE code == '72 (кроме 7201-7204)' or code=='7208-7212' \nGROUP BY q,name\nORDER BY q\n",
          "rawQuery": "SELECT\n    month as q,\n    name,\n    last_value(quantity)\nFROM default.export_goods\nWHERE code == '72 (кроме 7201-7204)' or code=='7208-7212' \nGROUP BY q,name\nORDER BY q",
          "refId": "C",
          "round": "0s",
          "skip_comments": true,
          "table": "export_goods",
          "tableLoading": false
        }
      ],
      "title": "Экспорт  России",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 149
      },
      "id": 38,
      "options": {
        "legend": {
          "calcs": [
            "last",
            "mean"
          ],
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "database": "default",
          "dateColDataType": "month",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    $dateCol as q,\n    last_value(if(runningDifference(export)>0,runningDifference(export),export)) as Export,\n    last_value(if(runningDifference(cis)>0,runningDifference(cis), cis)) as \"CIS\"\nFROM $table\n\nwhere name = 'ЧЕЛЯБИНСКАЯ ОБЛАСТЬ'\nGROUP BY q\nORDER BY q\n",
          "rawQuery": "SELECT\n    month as q,\n    last_value(if(runningDifference(export)>0,runningDifference(export),export)) as Export,\n    last_value(if(runningDifference(cis)>0,runningDifference(cis), cis)) as \"CIS\"\nFROM default.export_regions\n\nwhere name = 'ЧЕЛЯБИНСКАЯ ОБЛАСТЬ'\nGROUP BY q\nORDER BY q",
          "refId": "C",
          "round": "0s",
          "skip_comments": true,
          "table": "export_regions",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "month",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": true,
          "intervalFactor": 1,
          "query": "SELECT\n    $dateCol as q,\n    last_value(if(runningDifference(export)>0,runningDifference(export),export)) as Export,\n    last_value(if(runningDifference(cis)>0,runningDifference(cis), cis)) as \"CIS\"\nFROM $table\n\nwhere name = 'ЛИПЕЦКАЯ ОБЛАСТЬ'\nGROUP BY q\nORDER BY q",
          "rawQuery": "SELECT\n    month as q,\n    last_value(if(runningDifference(export)>0,runningDifference(export),export)) as Export,\n    last_value(if(runningDifference(cis)>0,runningDifference(cis), cis)) as \"CIS\"\nFROM default.export_regions\n\nwhere name = 'ЛИПЕЦКАЯ ОБЛАСТЬ'\nGROUP BY q\nORDER BY q",
          "refId": "A",
          "round": "0s",
          "skip_comments": true,
          "table": "export_regions",
          "tableLoading": false
        }
      ],
      "title": "Экспорт Челябинская область, млн. долл. США",
      "type": "timeseries"
    }
  ],
  "refresh": false,
  "schemaVersion": 33,
  "style": "dark",
  "tags": [],
  "templating": {
    "list": [
      {
        "current": {
          "selected": false,
          "text": "MAGN",
          "value": "MAGN"
        },
        "datasource": {
          "type": "vertamedia-clickhouse-datasource",
          "uid": "clickhouse"
        },
        "definition": "SELECT seccode FROM securities",
        "error": {
          "config": {
            "headers": {
              "X-Grafana-Org-Id": 1
            },
            "hideFromInspector": false,
            "method": "GET",
            "retry": 0,
            "url": "api/datasources/proxy/1/?query=SELECT%20seccode%20FROM%20securities%20FORMAT%20JSON"
          },
          "data": {
            "error": "Not Found",
            "message": "Code: 60. DB::Exception: Table default.securities doesn't exist. (UNKNOWN_TABLE) (version 21.11.6.7 (official build))\n",
            "response": "Code: 60. DB::Exception: Table default.securities doesn't exist. (UNKNOWN_TABLE) (version 21.11.6.7 (official build))\n"
          },
          "message": "Code: 60. DB::Exception: Table default.securities doesn't exist. (UNKNOWN_TABLE) (version 21.11.6.7 (official build))\n",
          "status": 404,
          "statusText": "Not Found"
        },
        "hide": 0,
        "includeAll": false,
        "label": "sec_code",
        "multi": false,
        "name": "sec_code",
        "options": [],
        "query": "SELECT seccode FROM securities",
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "type": "query"
      },
      {
        "current": {
          "selected": false,
          "text": "3",
          "value": "3"
        },
        "hide": 0,
        "includeAll": false,
        "multi": false,
        "name": "price_lag_months",
        "options": [
          {
            "selected": false,
            "text": "0",
            "value": "0"
          },
          {
            "selected": false,
            "text": "1",
            "value": "1"
          },
          {
            "selected": false,
            "text": "1.25",
            "value": "1.25"
          },
          {
            "selected": false,
            "text": "1.5",
            "value": "1.5"
          },
          {
            "selected": false,
            "text": "1.75",
            "value": "1.75"
          },
          {
            "selected": false,
            "text": "2",
            "value": "2"
          }
        ],
        "query": "0,1,1.25,1.5,1.75,2",
        "queryValue": "3",
        "skipUrlSync": false,
        "type": "custom"
      },
      {
        "current": {
          "selected": false,
          "text": "152",
          "value": "152"
        },
        "hide": 0,
        "includeAll": false,
        "label": "",
        "multi": false,
        "name": "forecast_IronSlab",
        "options": [
          {
            "selected": false,
            "text": "244",
            "value": "244"
          }
        ],
        "query": "244",
        "queryValue": "152",
        "skipUrlSync": false,
        "type": "custom"
      },
      {
        "current": {
          "selected": false,
          "text": "965",
          "value": "965"
        },
        "hide": 0,
        "includeAll": false,
        "multi": false,
        "name": "forecast_PriceAverage",
        "options": [
          {
            "selected": false,
            "text": "916",
            "value": "916"
          }
        ],
        "query": "916",
        "queryValue": "965",
        "skipUrlSync": false,
        "type": "custom"
      },
      {
        "current": {
          "selected": false,
          "text": "372.6",
          "value": "372.6"
        },
        "datasource": {
          "type": "vertamedia-clickhouse-datasource",
          "uid": "clickhouse"
        },
        "definition": "SELECT floor(sum(perc)+$forecast_IronSlab,1) as Slab\nFROM (\n      SELECT last_value(quarter) as q,\n             last_value(slab_cash_cost_structure.value) * last_value(financial_ratios.value) as perc\n      FROM slab_cash_cost_structure\n               LEFT JOIN financial_ratios ON\n              financial_ratios.quarter == slab_cash_cost_structure.quarter\n              and financial_ratios.sec_code == slab_cash_cost_structure.sec_code\n      WHERE (structure == 'Pellets'\n   or structure == 'Iron ore & concentrate'\n   or structure == 'Metal scrap')\n        and indicator == 'Slab Cash cost (USD/t)'\n      GROUP BY structure)\nGROUP BY q\nORDER BY q",
        "description": "",
        "hide": 0,
        "includeAll": false,
        "multi": false,
        "name": "forecast_Slab",
        "options": [],
        "query": "SELECT floor(sum(perc)+$forecast_IronSlab,1) as Slab\nFROM (\n      SELECT last_value(quarter) as q,\n             last_value(slab_cash_cost_structure.value) * last_value(financial_ratios.value) as perc\n      FROM slab_cash_cost_structure\n               LEFT JOIN financial_ratios ON\n              financial_ratios.quarter == slab_cash_cost_structure.quarter\n              and financial_ratios.sec_code == slab_cash_cost_structure.sec_code\n      WHERE (structure == 'Pellets'\n   or structure == 'Iron ore & concentrate'\n   or structure == 'Metal scrap')\n        and indicator == 'Slab Cash cost (USD/t)'\n      GROUP BY structure)\nGROUP BY q\nORDER BY q",
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "type": "query"
      },
      {
        "current": {
          "selected": false,
          "text": "3320",
          "value": "3320"
        },
        "hide": 0,
        "includeAll": false,
        "multi": false,
        "name": "forecast_sales",
        "options": [
          {
            "selected": true,
            "text": "3320",
            "value": "3320"
          }
        ],
        "query": "3320",
        "skipUrlSync": false,
        "type": "custom"
      },
      {
        "current": {
          "selected": true,
          "text": "18",
          "value": "18"
        },
        "hide": 0,
        "includeAll": false,
        "multi": false,
        "name": "price_lag_weeks",
        "options": [
          {
            "selected": false,
            "text": "13",
            "value": "13"
          },
          {
            "selected": false,
            "text": "15",
            "value": "15"
          },
          {
            "selected": false,
            "text": "17",
            "value": "17"
          },
          {
            "selected": true,
            "text": "18",
            "value": "18"
          },
          {
            "selected": false,
            "text": "19",
            "value": "19"
          }
        ],
        "query": "13,15,17,18,19",
        "queryValue": "",
        "skipUrlSync": false,
        "type": "custom"
      },
      {
        "current": {
          "selected": false,
          "text": "69",
          "value": "69"
        },
        "hide": 0,
        "includeAll": false,
        "multi": false,
        "name": "forecast_price",
        "options": [
          {
            "selected": true,
            "text": "78",
            "value": "78"
          }
        ],
        "query": "78",
        "queryValue": "69",
        "skipUrlSync": false,
        "type": "custom"
      }
    ]
  },
  "time": {
    "from": "now-4y+4M",
    "to": "now+1M"
  },
  "timepicker": {},
  "timezone": "",
  "title": "MAGN Forecast",
  "uid": "magn",
  "version": 7,
  "weekStart": ""
}