{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": "-- Grafana --",
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "target": {
          "limit": 100,
          "matchAny": false,
          "tags": [],
          "type": "dashboard"
        },
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "iteration": 1642844901413,
  "links": [],
  "liveNow": false,
  "panels": [
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "id": 43,
      "panels": [],
      "title": "Операционные результаты",
      "type": "row"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "description": "",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "masst"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Производство стали (без NBH)"
            },
            "properties": [
              {
                "id": "custom.lineStyle",
                "value": {
                  "dash": [
                    10,
                    10
                  ],
                  "fill": "dash"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "Загрузка"
            },
            "properties": [
              {
                "id": "unit",
                "value": "percent"
              },
              {
                "id": "custom.lineStyle",
                "value": {
                  "dash": [
                    0,
                    10
                  ],
                  "fill": "dot"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 17,
        "x": 0,
        "y": 1
      },
      "id": 44,
      "options": {
        "legend": {
          "calcs": [
            "last",
            "mean"
          ],
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    $dateCol as q,\n    last_value(value),\n    name\nFROM $table\nWHERE q >= toDate($from) and q <= toDate($to) and code == 'NLMK'\nand table == 'КЛЮЧЕВЫЕ ОПЕРАЦИОННЫЕ ПОКАЗАТЕЛИ'\nand name like 'Производство%'\nand category == 'Группа НЛМК'\nGROUP BY q, name\nORDER BY q\n",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(value),\n    name\nFROM default.operational_databook\nWHERE q >= toDate(1485081599) and q <= toDate(1642847999) and code == 'NLMK'\nand table == 'КЛЮЧЕВЫЕ ОПЕРАЦИОННЫЕ ПОКАЗАТЕЛИ'\nand name like 'Производство%'\nand category == 'Группа НЛМК'\nGROUP BY q, name\nORDER BY q",
          "refId": "A",
          "round": "0s",
          "skip_comments": true,
          "table": "operational_databook",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    $dateCol as q,\n    last_value(value) as \"Загрузка\"\nFROM $table\nWHERE q >= toDate($from) and q <= toDate($to) and code == 'NLMK'\nand table == 'КЛЮЧЕВЫЕ ОПЕРАЦИОННЫЕ ПОКАЗАТЕЛИ'\nand name == 'Загрузка производственных мощностей (c NBH)'\nand category == 'Группа НЛМК'\nGROUP BY q\nORDER BY q\n",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(value) as \"Загрузка\"\nFROM default.operational_databook\nWHERE q >= toDate(1485081599) and q <= toDate(1642847999) and code == 'NLMK'\nand table == 'КЛЮЧЕВЫЕ ОПЕРАЦИОННЫЕ ПОКАЗАТЕЛИ'\nand name == 'Загрузка производственных мощностей (c NBH)'\nand category == 'Группа НЛМК'\nGROUP BY q\nORDER BY q",
          "refId": "B",
          "round": "0s",
          "skip_comments": true,
          "table": "operational_databook",
          "tableLoading": false
        }
      ],
      "title": "Производство стали, млн т",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 1
              }
            ]
          },
          "unit": "percentunit"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 7,
        "x": 17,
        "y": 1
      },
      "id": 47,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "horizontal",
        "reduceOptions": {
          "calcs": [
            "last"
          ],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "pluginVersion": "8.3.3",
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "intervalFactor": 1,
          "query": "SELECT\n    $dateCol as q,\n    (last_value(value)/neighbor(last_value(value), -1))-1\nFROM $table\nWHERE q >= toDate($from) and q <= toDate($to) and code == 'NLMK'\nand table == 'КЛЮЧЕВЫЕ ОПЕРАЦИОННЫЕ ПОКАЗАТЕЛИ'\nand name == 'Производство стали (c NBH)'\nand category == 'Группа НЛМК'\nGROUP BY q\nORDER BY q",
          "rawQuery": "SELECT\n    quarter as q,\n    (last_value(value)/neighbor(last_value(value), -1))-1\nFROM default.operational_databook\nWHERE q >= toDate(1421922533) and q <= toDate(1642847333) and code == 'NLMK'\nand table == 'КЛЮЧЕВЫЕ ОПЕРАЦИОННЫЕ ПОКАЗАТЕЛИ'\nand name == 'Производство стали (c NBH)'\nand category == 'Группа НЛМК'\nGROUP BY q\nORDER BY q",
          "refId": "A",
          "round": "0s",
          "skip_comments": true,
          "table": "operational_databook",
          "tableLoading": false
        }
      ],
      "title": "Производство, кв/кв",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "description": "",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "smooth",
            "lineStyle": {
              "dash": [
                0,
                10
              ],
              "fill": "dot"
            },
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "percent"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Итого"
            },
            "properties": [
              {
                "id": "custom.lineStyle"
              },
              {
                "id": "unit",
                "value": "masst"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName"
            },
            "properties": []
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 17,
        "x": 0,
        "y": 9
      },
      "id": 49,
      "options": {
        "legend": {
          "calcs": [
            "last",
            "mean"
          ],
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    $dateCol as q,\n    last_value(value) as \"Итого\"\nFROM $table\nWHERE q >= toDate($from) and q <= toDate($to) and code == 'NLMK'\nand table == 'КЛЮЧЕВЫЕ ОПЕРАЦИОННЫЕ ПОКАЗАТЕЛИ'\nand name == 'Итого консолидированные продажи'\nand category == 'Консолидированные продажи, млн т'\nGROUP BY q\nORDER BY q\n",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(value) as \"Итого\"\nFROM default.operational_databook\nWHERE q >= toDate(1485083776) and q <= toDate(1642850176) and code == 'NLMK'\nand table == 'КЛЮЧЕВЫЕ ОПЕРАЦИОННЫЕ ПОКАЗАТЕЛИ'\nand name == 'Итого консолидированные продажи'\nand category == 'Консолидированные продажи, млн т'\nGROUP BY q\nORDER BY q",
          "refId": "A",
          "round": "0s",
          "skip_comments": true,
          "table": "operational_databook",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    $dateCol as q,\n    last_value(value) as \"локальные рынки\"\nFROM $table\nWHERE q >= toDate($from) and q <= toDate($to) and code == 'NLMK'\nand table == 'КЛЮЧЕВЫЕ ОПЕРАЦИОННЫЕ ПОКАЗАТЕЛИ'\nand name == 'Продажи на локальных рынках Группы 3'\nand category == 'Консолидированные продажи, млн т'\nGROUP BY q\nORDER BY q\n",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(value) as \"локальные рынки\"\nFROM default.operational_databook\nWHERE q >= toDate(1485083776) and q <= toDate(1642850176) and code == 'NLMK'\nand table == 'КЛЮЧЕВЫЕ ОПЕРАЦИОННЫЕ ПОКАЗАТЕЛИ'\nand name == 'Продажи на локальных рынках Группы 3'\nand category == 'Консолидированные продажи, млн т'\nGROUP BY q\nORDER BY q",
          "refId": "B",
          "round": "0s",
          "skip_comments": true,
          "table": "operational_databook",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    $dateCol as q,\n    last_value(value) as \"внешние рынки\"\nFROM $table\nWHERE q >= toDate($from) and q <= toDate($to) and code == 'NLMK'\nand table == 'КЛЮЧЕВЫЕ ОПЕРАЦИОННЫЕ ПОКАЗАТЕЛИ'\nand name == 'Продажи на внешних рынках'\nand category == 'Консолидированные продажи, млн т'\nGROUP BY q\nORDER BY q\n",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(value) as \"внешние рынки\"\nFROM default.operational_databook\nWHERE q >= toDate(1485083776) and q <= toDate(1642850176) and code == 'NLMK'\nand table == 'КЛЮЧЕВЫЕ ОПЕРАЦИОННЫЕ ПОКАЗАТЕЛИ'\nand name == 'Продажи на внешних рынках'\nand category == 'Консолидированные продажи, млн т'\nGROUP BY q\nORDER BY q",
          "refId": "D",
          "round": "0s",
          "skip_comments": true,
          "table": "operational_databook",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    $dateCol as q,\n    last_value(value)*100 as \"слябы дочкам\"\nFROM $table\nWHERE q >= toDate($from) and q <= toDate($to) and code == 'NLMK'\nand table == 'КЛЮЧЕВЫЕ ОПЕРАЦИОННЫЕ ПОКАЗАТЕЛИ'\nand name == 'Для информации: продажи слябов на зарубежные дочерние и зависимые компании'\nand category == 'Консолидированные продажи, млн т'\nGROUP BY q\nORDER BY q\n",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(value)*100 as \"слябы дочкам\"\nFROM default.operational_databook\nWHERE q >= toDate(1485083776) and q <= toDate(1642850176) and code == 'NLMK'\nand table == 'КЛЮЧЕВЫЕ ОПЕРАЦИОННЫЕ ПОКАЗАТЕЛИ'\nand name == 'Для информации: продажи слябов на зарубежные дочерние и зависимые компании'\nand category == 'Консолидированные продажи, млн т'\nGROUP BY q\nORDER BY q",
          "refId": "C",
          "round": "0s",
          "skip_comments": true,
          "table": "operational_databook",
          "tableLoading": false
        }
      ],
      "title": "Консолидированные продажи, млн т",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 1
              }
            ]
          },
          "unit": "percentunit"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 7,
        "x": 17,
        "y": 9
      },
      "id": 51,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "horizontal",
        "reduceOptions": {
          "calcs": [
            "last"
          ],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "pluginVersion": "8.3.3",
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "intervalFactor": 1,
          "query": "SELECT\n    $dateCol as q,\n    (last_value(value)/neighbor(last_value(value), -1))-1\nFROM $table\nWHERE q >= toDate($from) and q <= toDate($to) and code == 'NLMK'\nand table == 'КЛЮЧЕВЫЕ ОПЕРАЦИОННЫЕ ПОКАЗАТЕЛИ'\nand name == 'Итого консолидированные продажи'\nand category == 'Консолидированные продажи, млн т'\nGROUP BY q\nORDER BY q",
          "rawQuery": "SELECT\n    quarter as q,\n    (last_value(value)/neighbor(last_value(value), -1))-1\nFROM default.operational_databook\nWHERE q >= toDate(1485082720) and q <= toDate(1642849120) and code == 'NLMK'\nand table == 'КЛЮЧЕВЫЕ ОПЕРАЦИОННЫЕ ПОКАЗАТЕЛИ'\nand name == 'Итого консолидированные продажи'\nand category == 'Консолидированные продажи, млн т'\nGROUP BY q\nORDER BY q",
          "refId": "A",
          "round": "0s",
          "skip_comments": true,
          "table": "operational_databook",
          "tableLoading": false
        }
      ],
      "title": "Продажи, кв/кв",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "description": "",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "masst"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Производство стали (без NBH)"
            },
            "properties": [
              {
                "id": "custom.lineStyle",
                "value": {
                  "dash": [
                    0,
                    10
                  ],
                  "fill": "dot"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 17
      },
      "id": 50,
      "options": {
        "legend": {
          "calcs": [
            "last",
            "mean"
          ],
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    $dateCol as q,\n    last_value(value),\n    name\nFROM $table\nWHERE q >= toDate($from) and q <= toDate($to) and code == 'NLMK'\nand table == 'КЛЮЧЕВЫЕ ОПЕРАЦИОННЫЕ ПОКАЗАТЕЛИ'\nand ( name == 'Полуфабрикаты 2'\nor name == 'Плоский прокат'\nor name == 'Сортовая продукция и метизы'\n) and category == 'Консолидированные продажи, млн т'\nGROUP BY q, name\nORDER BY q\n",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(value),\n    name\nFROM default.operational_databook\nWHERE q >= toDate(1485082552) and q <= toDate(1642848952) and code == 'NLMK'\nand table == 'КЛЮЧЕВЫЕ ОПЕРАЦИОННЫЕ ПОКАЗАТЕЛИ'\nand ( name == 'Полуфабрикаты 2'\nor name == 'Плоский прокат'\nor name == 'Сортовая продукция и метизы'\n) and category == 'Консолидированные продажи, млн т'\nGROUP BY q, name\nORDER BY q",
          "refId": "A",
          "round": "0s",
          "skip_comments": true,
          "table": "operational_databook",
          "tableLoading": false
        }
      ],
      "title": "Консолидированные продажи, млн т",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "description": "",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "masst"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Производство стали (без NBH)"
            },
            "properties": [
              {
                "id": "custom.lineStyle",
                "value": {
                  "dash": [
                    0,
                    10
                  ],
                  "fill": "dot"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 17
      },
      "id": 48,
      "options": {
        "legend": {
          "calcs": [
            "last",
            "mean"
          ],
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    $dateCol as q,\n    last_value(value),\n    name\nFROM $table\nWHERE q >= toDate($from) and q <= toDate($to) and code == 'NLMK'\nand table == 'КЛЮЧЕВЫЕ ОПЕРАЦИОННЫЕ ПОКАЗАТЕЛИ'\nand category == 'Продажи сегментов'\nand name != 'Для информации: продажи NBH'\nand name != 'Добыча и переработка сырья'\nGROUP BY q, name\nORDER BY q\n",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(value),\n    name\nFROM default.operational_databook\nWHERE q >= toDate(1485082498) and q <= toDate(1642848898) and code == 'NLMK'\nand table == 'КЛЮЧЕВЫЕ ОПЕРАЦИОННЫЕ ПОКАЗАТЕЛИ'\nand category == 'Продажи сегментов'\nand name != 'Для информации: продажи NBH'\nand name != 'Добыча и переработка сырья'\nGROUP BY q, name\nORDER BY q",
          "refId": "A",
          "round": "0s",
          "skip_comments": true,
          "table": "operational_databook",
          "tableLoading": false
        }
      ],
      "title": "Продажи сегментов, млн т",
      "type": "timeseries"
    },
    {
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 25
      },
      "id": 6,
      "panels": [
        {
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 9,
            "w": 24,
            "x": 0,
            "y": 1
          },
          "id": 2,
          "maxDataPoints": 80,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom"
            },
            "tooltip": {
              "mode": "single"
            }
          },
          "targets": [
            {
              "database": "default",
              "dateColDataType": "",
              "dateLoading": false,
              "dateTimeColDataType": "date",
              "dateTimeType": "DATETIME",
              "datetimeLoading": false,
              "extrapolate": true,
              "format": "time_series",
              "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
              "hide": false,
              "intervalFactor": 1,
              "query": "SELECT\n    $timeSeries as t,\n    avgWeighted(close, volume) as price\nFROM $table\n\nWHERE\n    $timeFilter\n    and sec_code = 'NLMK'\nGROUP BY t\nORDER BY t\n",
              "queryType": "randomWalk",
              "rawQuery": "SELECT\n    (intDiv(toUInt32(date), 604800) * 604800) * 1000 as t,\n    avgWeighted(close, volume) as price\nFROM default.candles\n\nWHERE\n    date >= toDateTime(1520176154) AND date <= toDateTime(1636038554)\n    and sec_code = 'MAGN'\nGROUP BY t\nORDER BY t",
              "refId": "close",
              "round": "0s",
              "skip_comments": true,
              "table": "candles",
              "tableLoading": false
            }
          ],
          "title": "Price History",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisLabel": "",
                "axisPlacement": "left",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "smooth",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "Stock price avg"
                },
                "properties": [
                  {
                    "id": "custom.lineStyle",
                    "value": {
                      "dash": [
                        10,
                        10
                      ],
                      "fill": "dash"
                    }
                  },
                  {
                    "id": "unit",
                    "value": "currencyRUB"
                  },
                  {
                    "id": "custom.axisPlacement",
                    "value": "right"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Price close"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "currencyRUB"
                  },
                  {
                    "id": "custom.lineStyle",
                    "value": {
                      "dash": [
                        0,
                        10
                      ],
                      "fill": "dot"
                    }
                  },
                  {
                    "id": "custom.showPoints",
                    "value": "never"
                  },
                  {
                    "id": "custom.lineWidth",
                    "value": 2
                  },
                  {
                    "id": "custom.axisPlacement",
                    "value": "right"
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 9,
            "w": 24,
            "x": 0,
            "y": 10
          },
          "id": 35,
          "maxDataPoints": 80,
          "options": {
            "legend": {
              "calcs": [
                "last",
                "mean"
              ],
              "displayMode": "list",
              "placement": "bottom"
            },
            "tooltip": {
              "mode": "single"
            }
          },
          "targets": [
            {
              "database": "default",
              "datasource": {
                "type": "vertamedia-clickhouse-datasource",
                "uid": "clickhouse"
              },
              "dateColDataType": "",
              "dateLoading": false,
              "dateTimeColDataType": "date",
              "dateTimeType": "DATETIME",
              "datetimeLoading": false,
              "extrapolate": true,
              "format": "time_series",
              "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
              "hide": false,
              "intervalFactor": 1,
              "query": "select * FROM (SELECT\n    toDate(toStartOfQuarter(date_add(day, 44 , date))) as q,\n    avgWeighted(close, volume) as \"Stock price avg\"\nFROM $table\nWHERE\n    $timeFilter and sec_code == 'NLMK' and period == 5\nGROUP BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , $forecast_price))\nORDER BY q",
              "rawQuery": "select * FROM (SELECT\n    toDate(toStartOfQuarter(date_add(day, 44 , date))) as q,\n    avgWeighted(close, volume) as \"Stock price avg\"\nFROM default.candles\nWHERE\n    date >= toDateTime(1574982803) AND date <= toDateTime(1646074799) and sec_code == 'NLMK' and period == 5\nGROUP BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , 230))\nORDER BY q",
              "refId": "close",
              "round": "0s",
              "skip_comments": true,
              "table": "candles",
              "tableLoading": false
            },
            {
              "database": "default",
              "datasource": {
                "type": "vertamedia-clickhouse-datasource",
                "uid": "clickhouse"
              },
              "dateColDataType": "quarter",
              "dateLoading": false,
              "dateTimeColDataType": "date",
              "dateTimeType": "DATETIME",
              "datetimeLoading": false,
              "extrapolate": true,
              "format": "time_series",
              "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
              "hide": false,
              "intervalFactor": 1,
              "query": "select * from (select p.q, (p.price*$shares)/((t.value*73)*4) as \"3M EV/EBITDA\" FROM (\nSELECT\n    toDate(toStartOfQuarter(date_add(day, 44 , date))) as q,\n    avgWeighted(close, volume) as price\nFROM candles\nWHERE sec_code == 'NLMK' and period == 5 and $dateTimeCol >= toDate($from) and $dateTimeCol <= toDate($to)\nGROUP BY q) as p\nLEFT JOIN $table as t ON p.q == t.quarter\nWHERE t.indicator == 'EBITDA' and t.sec_code == 'NLMK' and $dateCol >= toDate($from) and $dateCol <= toDate($to)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , $forecast_price*$shares/(1857*73*4)))\nORDER by q",
              "queryType": "randomWalk",
              "rawQuery": "select * from (select p.q, (p.price*5993.23)/((t.value*73)*4) as \"3M EV/EBITDA\" FROM (\nSELECT\n    toDate(toStartOfQuarter(date_add(day, 44 , date))) as q,\n    avgWeighted(close, volume) as price\nFROM candles\nWHERE sec_code == 'NLMK' and period == 5 and date >= toDate(1574982803) and date <= toDate(1646074799)\nGROUP BY q) as p\nLEFT JOIN default.financial_highlights as t ON p.q == t.quarter\nWHERE t.indicator == 'EBITDA' and t.sec_code == 'NLMK' and quarter >= toDate(1574982803) and quarter <= toDate(1646074799)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , 230*5993.23/(1857*73*4)))\nORDER by q",
              "refId": "A",
              "round": "0s",
              "skip_comments": true,
              "table": "financial_highlights",
              "tableLoading": false
            },
            {
              "database": "default",
              "datasource": {
                "type": "vertamedia-clickhouse-datasource",
                "uid": "clickhouse"
              },
              "dateColDataType": "quarter",
              "dateLoading": false,
              "dateTimeColDataType": "date",
              "dateTimeType": "DATETIME",
              "datetimeLoading": false,
              "extrapolate": true,
              "format": "time_series",
              "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
              "hide": false,
              "intervalFactor": 1,
              "query": "select * from (select p.q, (p.price*$shares)/((t.value*73)) as \"12M EV/EBITDA\" FROM (\nSELECT\n    toDate(toStartOfQuarter(date_add(day, 44 , date))) as q,\n    avgWeighted(close, volume) as price\nFROM candles\nWHERE sec_code == 'NLMK' and period == 5 and $dateTimeCol >= toDate($from) and $dateTimeCol <= toDate($to)\nGROUP BY q) as p\nLEFT JOIN $table as t ON p.q == t.quarter\nWHERE t.indicator == '12M EBITDA' and t.sec_code == 'NLMK' and $dateCol >= toDate($from) and $dateCol <= toDate($to)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , $forecast_price*$shares/((5510+1857)*73)))\nORDER by q",
              "queryType": "randomWalk",
              "rawQuery": "select * from (select p.q, (p.price*5993.23)/((t.value*73)) as \"12M EV/EBITDA\" FROM (\nSELECT\n    toDate(toStartOfQuarter(date_add(day, 44 , date))) as q,\n    avgWeighted(close, volume) as price\nFROM candles\nWHERE sec_code == 'NLMK' and period == 5 and date >= toDate(1574982803) and date <= toDate(1646074799)\nGROUP BY q) as p\nLEFT JOIN default.financial_highlights as t ON p.q == t.quarter\nWHERE t.indicator == '12M EBITDA' and t.sec_code == 'NLMK' and quarter >= toDate(1574982803) and quarter <= toDate(1646074799)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , 230*5993.23/((5510+1857)*73)))\nORDER by q",
              "refId": "B",
              "round": "0s",
              "skip_comments": true,
              "table": "financial_highlights",
              "tableLoading": false
            },
            {
              "database": "default",
              "datasource": {
                "type": "vertamedia-clickhouse-datasource",
                "uid": "clickhouse"
              },
              "dateColDataType": "",
              "dateLoading": false,
              "dateTimeColDataType": "date",
              "dateTimeType": "DATETIME",
              "datetimeLoading": false,
              "extrapolate": true,
              "format": "time_series",
              "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
              "hide": false,
              "intervalFactor": 1,
              "query": "SELECT\n    $timeSeries as t,\n    avgWeighted(close, volume) as \"Price close\"\nFROM $table\nWHERE\n    $timeFilter\n    and sec_code == 'NLMK' and period == 5\nGROUP BY t\nORDER BY t",
              "rawQuery": "SELECT\n    (intDiv(toUInt32(date), 604800) * 604800) * 1000 as t,\n    avgWeighted(close, volume) as \"Price close\"\nFROM default.candles\nWHERE\n    date >= toDateTime(1574982803) AND date <= toDateTime(1646074799)\n    and sec_code == 'NLMK' and period == 5\nGROUP BY t\nORDER BY t",
              "refId": "C",
              "round": "0s",
              "skip_comments": true,
              "table": "candles",
              "tableLoading": false
            }
          ],
          "title": "Price History",
          "type": "timeseries"
        }
      ],
      "title": "TRANSAQ",
      "type": "row"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 26
      },
      "id": 4,
      "panels": [],
      "title": "HIGHLIGHTS",
      "type": "row"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "left",
            "axisSoftMin": 0,
            "fillOpacity": 80,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineWidth": 1
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "CAPEX"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "red",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "EBITDA"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "green",
                  "mode": "fixed"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 27
      },
      "id": 8,
      "options": {
        "barWidth": 1,
        "groupWidth": 0.95,
        "legend": {
          "calcs": [
            "last",
            "mean"
          ],
          "displayMode": "list",
          "placement": "bottom"
        },
        "orientation": "auto",
        "showValue": "auto",
        "stacking": "none",
        "text": {
          "valueSize": 24
        },
        "tooltip": {
          "mode": "single"
        },
        "xTickLabelRotation": 0
      },
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "table",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "intervalFactor": 1,
          "query": "select quarter_name, CAPEX, EBITDA, Revenue from (\n  select $dateCol as q,\n         last_value(multiIf(equals(has(array('CAPEX','Purchases and construction of property, plant and equipment'), indicator), 1), value, NULL)) as CAPEX,\n         last_value(multiIf(equals(has(array('EBITDA'), indicator), 1), value, NULL)) as EBITDA,\n         last_value(multiIf(equals(has(array('REVENUE'), indicator), 1), value, NULL)) as Revenue,\n         quarter_name\n  from $table\n  where sec_code == 'NLMK' and $dateCol >= toDate($from) and $dateCol <= toDate($to)\n  group by quarter_name, $dateCol\n  UNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , -340, 1857, 4128, 'Q4 2021' as quarter_name)\n)\nWHERE q >= toDate($from) and q <= toDate($to)\norder by q\n\n",
          "queryType": "randomWalk",
          "rawQuery": "select quarter_name, CAPEX, EBITDA, Revenue from (\n  select quarter as q,\n         last_value(multiIf(equals(has(array('CAPEX','Purchases and construction of property, plant and equipment'), indicator), 1), value, NULL)) as CAPEX,\n         last_value(multiIf(equals(has(array('EBITDA'), indicator), 1), value, NULL)) as EBITDA,\n         last_value(multiIf(equals(has(array('REVENUE'), indicator), 1), value, NULL)) as Revenue,\n         quarter_name\n  from default.financial_highlights\n  where sec_code == 'NLMK' and quarter >= toDate(1574979927) and quarter <= toDate(1646074799)\n  group by quarter_name, quarter\n  UNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , -340, 1857, 4128, 'Q4 2021' as quarter_name)\n)\nWHERE q >= toDate(1574979927) and q <= toDate(1646074799)\norder by q",
          "refId": "A",
          "round": "0s",
          "skip_comments": true,
          "table": "financial_highlights",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "select quarter_name, CAPEX, EBITDA, Revenue from (select $dateCol as q,\n       last_value(multiIf(equals(indicator,'CAPEX'), value, NULL)) as CAPEX,\n       last_value(multiIf(equals(indicator,'EBITDA'), value, NULL)) as EBITDA,\n       last_value(multiIf(equals(indicator,'Revenue'), value, NULL)) as Revenue,\n       quarter_name\n       \nfrom $table where sec_code == 'NLMK' and $dateCol >= toDate($from) and $dateCol <= toDate($to)\ngroup by quarter_name, $dateCol\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , -350, 2002, 4400, 'Q3 2021' as quarter_name)\n)\norder by q\n",
          "rawQuery": "select quarter_name, CAPEX, EBITDA, Revenue from (select quarter as q,\n       last_value(multiIf(equals(indicator,'CAPEX'), value, NULL)) as CAPEX,\n       last_value(multiIf(equals(indicator,'EBITDA'), value, NULL)) as EBITDA,\n       last_value(multiIf(equals(indicator,'Revenue'), value, NULL)) as Revenue,\n       quarter_name\n       \nfrom default.financial_highlights where sec_code == 'NLMK' and quarter >= toDate(1574979927) and quarter <= toDate(1646074799)\ngroup by quarter_name, quarter\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , -350, 2002, 4400, 'Q3 2021' as quarter_name)\n)\norder by q",
          "refId": "B",
          "round": "0s",
          "skip_comments": true,
          "table": "financial_highlights",
          "tableLoading": false
        }
      ],
      "title": "Динамика Выручки и EBITDA",
      "transformations": [],
      "type": "barchart"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "left",
            "axisSoftMin": 0,
            "fillOpacity": 80,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineWidth": 1
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "CAPEX"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "red",
                  "mode": "fixed"
                }
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "EBITDA"
            },
            "properties": [
              {
                "id": "color",
                "value": {
                  "fixedColor": "green",
                  "mode": "fixed"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 35
      },
      "id": 9,
      "options": {
        "barWidth": 1,
        "groupWidth": 0.96,
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom"
        },
        "orientation": "auto",
        "showValue": "always",
        "stacking": "none",
        "text": {},
        "tooltip": {
          "mode": "single"
        },
        "xTickLabelRotation": 0
      },
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "table",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "intervalFactor": 1,
          "query": "select quarter_name,\n       last_value(multiIf(equals(indicator,'Free cash flow'), value, NULL)) as FCF,\n       last_value(multiIf(equals(indicator,'Dividends to shareholders'), value, NULL)) as Dividends,\n       last_value(multiIf(equals(has(array('CAPEX','Purchases and construction of property, plant and equipment'), indicator), 1), value, NULL)) as CAPEX\nfrom $table where sec_code == 'NLMK' and $dateCol >= toDate($from) and $dateCol <= toDate($to)\ngroup by quarter_name, $dateCol\norder by $dateCol\n\n\n",
          "queryType": "randomWalk",
          "rawQuery": "select quarter_name,\n       last_value(multiIf(equals(indicator,'Free cash flow'), value, NULL)) as FCF,\n       last_value(multiIf(equals(indicator,'Dividends to shareholders'), value, NULL)) as Dividends,\n       last_value(multiIf(equals(has(array('CAPEX','Purchases and construction of property, plant and equipment'), indicator), 1), value, NULL)) as CAPEX\nfrom default.financial_highlights where sec_code == 'NLMK' and quarter >= toDate(1574976923) and quarter <= toDate(1646074799)\ngroup by quarter_name, quarter\norder by quarter",
          "refId": "A",
          "round": "0s",
          "skip_comments": true,
          "table": "financial_highlights",
          "tableLoading": false
        }
      ],
      "title": "Динамика Свободного денежного потока",
      "transformations": [],
      "type": "barchart"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "description": "",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "masst"
        },
        "overrides": [
          {
            "__systemRef": "hideSeriesFrom",
            "matcher": {
              "id": "byNames",
              "options": {
                "mode": "exclude",
                "names": [
                  "Steel production"
                ],
                "prefix": "All except:",
                "readOnly": true
              }
            },
            "properties": [
              {
                "id": "custom.hideFrom",
                "value": {
                  "legend": false,
                  "tooltip": false,
                  "viz": true
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 43
      },
      "id": 27,
      "options": {
        "legend": {
          "calcs": [
            "last",
            "mean",
            "sum"
          ],
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT * FROM (SELECT\n    $dateCol as q,\n    last_value(value) as \"Steel production\"\nFROM $table\nWHERE sec_code == 'NLMK' and has(array('Steel production, \\'000 t*'), product) == 1\nGROUP BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q, 4536))\nWHERE q >= toDate($from) and q <= toDate($to)\nORDER BY q\n",
          "queryType": "randomWalk",
          "rawQuery": "SELECT * FROM (SELECT\n    quarter as q,\n    last_value(value) as \"Steel production\"\nFROM default.operational_highlights\nWHERE sec_code == 'NLMK' and has(array('Steel production, \\'000 t*'), product) == 1\nGROUP BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q, 4536))\nWHERE q >= toDate(1574978918) and q <= toDate(1646074799)\nORDER BY q",
          "refId": "B",
          "round": "0s",
          "skip_comments": true,
          "table": "operational_highlights",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": true,
          "intervalFactor": 1,
          "query": "SELECT q, sum(value) as Cost\nFROM (SELECT\n    $dateCol as q,\n    indicator,\n    last_value(multiIf(equals(indicator,'Profit from operations'), -value, value)) as value\nFROM $table\nWHERE sec_code == 'NLMK' and has(array('Revenue - third parties', 'Revenue - related parties', 'Profit from operations'),indicator ) == 1\nGROUP BY q, indicator)\nGROUP BY q\nORDER BY q",
          "queryType": "randomWalk",
          "rawQuery": "SELECT q, sum(value) as Cost\nFROM (SELECT\n    quarter as q,\n    indicator,\n    last_value(multiIf(equals(indicator,'Profit from operations'), -value, value)) as value\nFROM default.financial_highlights\nWHERE sec_code == 'NLMK' and has(array('Revenue - third parties', 'Revenue - related parties', 'Profit from operations'),indicator ) == 1\nGROUP BY q, indicator)\nGROUP BY q\nORDER BY q",
          "refId": "A",
          "round": "0s",
          "skip_comments": true,
          "table": "financial_highlights",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": true,
          "intervalFactor": 1,
          "query": "SELECT q, sum(value) as Amortisation\nFROM (SELECT\n    $dateCol as q,\n    indicator,\n    last_value(value) as value\nFROM $table\nWHERE sec_code == 'NLMK' and has(array('Depreciation and amortisation'),indicator ) == 1\nGROUP BY q, indicator)\nGROUP BY q\nORDER BY q\n",
          "queryType": "randomWalk",
          "rawQuery": "SELECT q, sum(value) as Amortisation\nFROM (SELECT\n    quarter as q,\n    indicator,\n    last_value(value) as value\nFROM default.financial_highlights\nWHERE sec_code == 'NLMK' and has(array('Depreciation and amortisation'),indicator ) == 1\nGROUP BY q, indicator)\nGROUP BY q\nORDER BY q",
          "refId": "C",
          "round": "0s",
          "skip_comments": true,
          "table": "financial_highlights",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": true,
          "intervalFactor": 1,
          "query": "SELECT q, sum(value) as \"Interest paid\"\nFROM (SELECT\n    $dateCol as q,\n    indicator,\n    last_value(value) as value\nFROM $table\nWHERE sec_code == 'NLMK' and has(array('Interest paid'),indicator ) == 1\nGROUP BY q, indicator)\nGROUP BY q\nORDER BY q\n",
          "queryType": "randomWalk",
          "rawQuery": "SELECT q, sum(value) as \"Interest paid\"\nFROM (SELECT\n    quarter as q,\n    indicator,\n    last_value(value) as value\nFROM default.financial_highlights\nWHERE sec_code == 'NLMK' and has(array('Interest paid'),indicator ) == 1\nGROUP BY q, indicator)\nGROUP BY q\nORDER BY q",
          "refId": "D",
          "round": "0s",
          "skip_comments": true,
          "table": "financial_highlights",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": true,
          "intervalFactor": 1,
          "query": "SELECT q, sum(value) as \"Income tax paid\"\nFROM (SELECT\n    $dateCol as q,\n    indicator,\n    last_value(value) as value\nFROM $table\nWHERE sec_code == 'NLMK' and has(array('Income tax paid'),indicator ) == 1\nGROUP BY q, indicator)\nGROUP BY q\nORDER BY q\n",
          "queryType": "randomWalk",
          "rawQuery": "SELECT q, sum(value) as \"Income tax paid\"\nFROM (SELECT\n    quarter as q,\n    indicator,\n    last_value(value) as value\nFROM default.financial_highlights\nWHERE sec_code == 'NLMK' and has(array('Income tax paid'),indicator ) == 1\nGROUP BY q, indicator)\nGROUP BY q\nORDER BY q",
          "refId": "E",
          "round": "0s",
          "skip_comments": true,
          "table": "financial_highlights",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": true,
          "intervalFactor": 1,
          "query": "SELECT \n   q,\n   value-neighbor(value, -1) as \"NWC change\",\n   value as NWC\nFROM (SELECT\n    $dateCol as q,\n    last_value(value) as value\n    FROM $table WHERE sec_code == 'NLMK' and indicator == 'Net cash from operating activities' \n    GROUP BY q, indicator ORDER BY q)\nORDER BY q\n",
          "queryType": "randomWalk",
          "rawQuery": "SELECT \n   q,\n   value-neighbor(value, -1) as \"NWC change\",\n   value as NWC\nFROM (SELECT\n    quarter as q,\n    last_value(value) as value\n    FROM default.financial_highlights WHERE sec_code == 'NLMK' and indicator == 'Net cash from operating activities' \n    GROUP BY q, indicator ORDER BY q)\nORDER BY q",
          "refId": "F",
          "round": "0s",
          "skip_comments": true,
          "table": "financial_highlights",
          "tableLoading": false
        }
      ],
      "title": "Производство стали, тыс. тон",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "Other production"
            },
            "properties": [
              {
                "id": "custom.lineStyle",
                "value": {
                  "dash": [
                    10,
                    10
                  ],
                  "fill": "dash"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 51
      },
      "id": 36,
      "options": {
        "legend": {
          "calcs": [
            "last",
            "mean"
          ],
          "displayMode": "table",
          "placement": "right"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT q, indicator, last_value(v)  FROM (SELECT\n    $dateCol as q,\n    indicator,\n    last_value(value) as v\nFROM $table\nWHERE sec_code == 'NLMK'and has(array('Cash cost of slabs (USD/t) ', 'Revenue per tonne of sales, $/t', 'EBITDA per tonne of sales, $/t'), indicator) == 1 \nGROUP BY q,indicator\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q ,'Revenue per tonne of sales, $/t', 960)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q ,'Cash cost of slabs (USD/t) ', 278)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q ,'EBITDA per tonne of sales, $/t', (960.0-278-250)))\nWHERE q >= toDate($from) and q <= toDate($to)\nGROUP BY q, indicator\nORDER BY q, indicator",
          "rawQuery": "SELECT q, indicator, last_value(v)  FROM (SELECT\n    quarter as q,\n    indicator,\n    last_value(value) as v\nFROM default.financial_ratios\nWHERE sec_code == 'NLMK'and has(array('Cash cost of slabs (USD/t) ', 'Revenue per tonne of sales, $/t', 'EBITDA per tonne of sales, $/t'), indicator) == 1 \nGROUP BY q,indicator\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q ,'Revenue per tonne of sales, $/t', 960)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q ,'Cash cost of slabs (USD/t) ', 278)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q ,'EBITDA per tonne of sales, $/t', (960.0-278-250)))\nWHERE q >= toDate(1574979162) and q <= toDate(1646074799)\nGROUP BY q, indicator\nORDER BY q, indicator",
          "refId": "A",
          "round": "0s",
          "skip_comments": true,
          "table": "financial_ratios",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT r.quarter, last_value(r.value) - last_value(e.value) - last_value(s.value) as \"Other production cost\"\nFROM $table as r\nLEFT JOIN $table as e on e.quarter == r.quarter and e.sec_code == r.sec_code\nLEFT JOIN $table as s on s.quarter == r.quarter and s.sec_code == r.sec_code\nWHERE r.sec_code == 'NLMK' and s.indicator == 'Cash cost of slabs (USD/t) ' and e.indicator == 'EBITDA per tonne of sales, $/t' and r.indicator == 'Revenue per tonne of sales, $/t'\nand r.quarter >= toDate($from) and r.quarter <= toDate($to)\nGROUP BY r.quarter",
          "rawQuery": "SELECT r.quarter, last_value(r.value) - last_value(e.value) - last_value(s.value) as \"Other production cost\"\nFROM default.financial_ratios as r\nLEFT JOIN default.financial_ratios as e on e.quarter == r.quarter and e.sec_code == r.sec_code\nLEFT JOIN default.financial_ratios as s on s.quarter == r.quarter and s.sec_code == r.sec_code\nWHERE r.sec_code == 'NLMK' and s.indicator == 'Cash cost of slabs (USD/t) ' and e.indicator == 'EBITDA per tonne of sales, $/t' and r.indicator == 'Revenue per tonne of sales, $/t'\nGROUP BY r.quarter",
          "refId": "B",
          "round": "0s",
          "skip_comments": true,
          "table": "financial_ratios",
          "tableLoading": false
        }
      ],
      "title": "EBITDA/т и цена реализации металлопродукции USD/т",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "axisSoftMin": 0,
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "NWC/(Revenue L3m*4)"
            },
            "properties": [
              {
                "id": "unit",
                "value": "percent"
              },
              {
                "id": "custom.lineStyle",
                "value": {
                  "dash": [
                    10,
                    10
                  ],
                  "fill": "dash"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 59
      },
      "id": 37,
      "options": {
        "legend": {
          "calcs": [
            "last",
            "mean"
          ],
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT q, indicator, last_value(v) FROM (SELECT\n    $dateCol as q,\n    indicator,\n    last_value(value) as v\nFROM $table\nWHERE sec_code == 'NLMK' and has(array('Trade and other accounts receivable','Inventories'), indicator) == 1\nGROUP BY q, indicator\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , 'Trade and other accounts receivable' as indicator, 1700 as v)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , 'Inventories' as indicator, 1850 as v))\nGROUP BY q, indicator\nORDER BY q, last_value(v)\n",
          "queryType": "randomWalk",
          "rawQuery": "SELECT q, indicator, last_value(v) FROM (SELECT\n    quarter as q,\n    indicator,\n    last_value(value) as v\nFROM default.financial_ratios\nWHERE sec_code == 'NLMK' and has(array('Trade and other accounts receivable','Inventories'), indicator) == 1\nGROUP BY q, indicator\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , 'Trade and other accounts receivable' as indicator, 1700 as v)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , 'Inventories' as indicator, 1850 as v))\nGROUP BY q, indicator\nORDER BY q, last_value(v)",
          "refId": "B",
          "round": "0s",
          "skip_comments": true,
          "table": "financial_ratios",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT q, sum(n.v)/(last_value(h.value)*4)*100 as \"NWC/(Revenue L3m*4)\"\nFROM (SELECT\n    $dateCol as q,\n    indicator,\n    last_value(value) as v\nFROM $table\nWHERE sec_code == 'NLMK' and has(array('Trade and other accounts receivable','Inventories'), indicator) == 1\nGROUP BY q, indicator\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , 'Trade and other accounts receivable' as indicator, 1700 as v)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , 'Inventories' as indicator, 1850 as v)) as n\nLEFT JOIN (SELECT * FROM financial_highlights \nUNION ALL (SELECT 'NLMK' as sec_code, toDate(toStartOfQuarter(date_add(month, 2, now()))) as quarter, 'Q3 2021' as quarter_name, 'REVENUE' as indicator, 4400 as value)) as h on h.quarter == n.q\nWHERE h.sec_code == 'NLMK' and h.indicator == 'REVENUE'\nGROUP BY q\nORDER BY q\n",
          "queryType": "randomWalk",
          "rawQuery": "SELECT q, sum(n.v)/(last_value(h.value)*4)*100 as \"NWC/(Revenue L3m*4)\"\nFROM (SELECT\n    quarter as q,\n    indicator,\n    last_value(value) as v\nFROM default.financial_ratios\nWHERE sec_code == 'NLMK' and has(array('Trade and other accounts receivable','Inventories'), indicator) == 1\nGROUP BY q, indicator\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , 'Trade and other accounts receivable' as indicator, 1700 as v)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , 'Inventories' as indicator, 1850 as v)) as n\nLEFT JOIN (SELECT * FROM financial_highlights \nUNION ALL (SELECT 'NLMK' as sec_code, toDate(toStartOfQuarter(date_add(month, 2, now()))) as quarter, 'Q3 2021' as quarter_name, 'REVENUE' as indicator, 4400 as value)) as h on h.quarter == n.q\nWHERE h.sec_code == 'NLMK' and h.indicator == 'REVENUE'\nGROUP BY q\nORDER BY q",
          "refId": "A",
          "round": "0s",
          "skip_comments": true,
          "table": "financial_ratios",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": true,
          "intervalFactor": 1,
          "query": "SELECT q, sum(n.v)/(last_value(h.value)*4)*100 as \"NWC/(Revenue L3m*4)\"\nFROM (SELECT\n    $dateCol as q,\n    indicator,\n    last_value(value) as v\nFROM $table\nWHERE sec_code == 'NLMK' and has(array('Trade and other accounts receivable','Inventories'), indicator) == 1\nGROUP BY q, indicator\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , 'Trade and other accounts receivable' as indicator, 1700 as v)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , 'Inventories' as indicator, 1850 as v)) as n\nLEFT JOIN financial_highlights as h on h.quarter == n.q\nWHERE h.sec_code == 'NLMK' and h.indicator == 'REVENUE'\nGROUP BY q\n\nORDER BY q\n",
          "queryType": "randomWalk",
          "rawQuery": "SELECT q, sum(n.v)/(last_value(h.value)*4)*100 as \"NWC/(Revenue L3m*4)\"\nFROM (SELECT\n    quarter as q,\n    indicator,\n    last_value(value) as v\nFROM default.financial_ratios\nWHERE sec_code == 'NLMK' and has(array('Trade and other accounts receivable','Inventories'), indicator) == 1\nGROUP BY q, indicator\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , 'Trade and other accounts receivable' as indicator, 1700 as v)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , 'Inventories' as indicator, 1850 as v)) as n\nLEFT JOIN financial_highlights as h on h.quarter == n.q\nWHERE h.sec_code == 'NLMK' and h.indicator == 'REVENUE'\nGROUP BY q\n\nORDER BY q",
          "refId": "C",
          "round": "0s",
          "skip_comments": true,
          "table": "financial_ratios",
          "tableLoading": false
        }
      ],
      "title": "Оборотные активы",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "axisSoftMin": 0,
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "NWC/(Revenue L3m*4)"
            },
            "properties": [
              {
                "id": "unit",
                "value": "percent"
              },
              {
                "id": "custom.lineStyle",
                "value": {
                  "dash": [
                    10,
                    10
                  ],
                  "fill": "dash"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 67
      },
      "id": 38,
      "options": {
        "legend": {
          "calcs": [
            "last",
            "mean"
          ],
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT q, indicator, last_value(v) FROM (SELECT\n    $dateCol as q,\n    indicator,\n    last_value(value) as v\nFROM $table\nWHERE sec_code == 'NLMK' and has(array('Trade and other accounts receivable','Inventories'), indicator) == 1\nGROUP BY q, indicator\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , 'Trade and other accounts receivable' as indicator, 1700 as v)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , 'Inventories' as indicator, 1850 as v))\nGROUP BY q, indicator\nORDER BY q, last_value(v)\n",
          "queryType": "randomWalk",
          "rawQuery": "SELECT q, indicator, last_value(v) FROM (SELECT\n    quarter as q,\n    indicator,\n    last_value(value) as v\nFROM default.financial_ratios\nWHERE sec_code == 'NLMK' and has(array('Trade and other accounts receivable','Inventories'), indicator) == 1\nGROUP BY q, indicator\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , 'Trade and other accounts receivable' as indicator, 1700 as v)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , 'Inventories' as indicator, 1850 as v))\nGROUP BY q, indicator\nORDER BY q, last_value(v)",
          "refId": "B",
          "round": "0s",
          "skip_comments": true,
          "table": "financial_ratios",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT q, sum(n.v)/(last_value(h.value)*4)*100 as \"NWC/(Revenue L3m*4)\"\nFROM (SELECT\n    $dateCol as q,\n    indicator,\n    last_value(value) as v\nFROM $table\nWHERE sec_code == 'NLMK' and has(array('Trade and other accounts receivable','Inventories'), indicator) == 1\nGROUP BY q, indicator\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , 'Trade and other accounts receivable' as indicator, 1700 as v)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , 'Inventories' as indicator, 1850 as v)) as n\nLEFT JOIN (SELECT * FROM financial_highlights \nUNION ALL (SELECT 'NLMK' as sec_code, toDate(toStartOfQuarter(date_add(month, 1, now()))) as quarter, 'Q3 2021' as quarter_name, 'REVENUE' as indicator, 4400 as value)) as h on h.quarter == n.q\nWHERE h.sec_code == 'NLMK' and h.indicator == 'REVENUE'\nGROUP BY q\nORDER BY q\n",
          "queryType": "randomWalk",
          "rawQuery": "SELECT q, sum(n.v)/(last_value(h.value)*4)*100 as \"NWC/(Revenue L3m*4)\"\nFROM (SELECT\n    quarter as q,\n    indicator,\n    last_value(value) as v\nFROM default.financial_ratios\nWHERE sec_code == 'NLMK' and has(array('Trade and other accounts receivable','Inventories'), indicator) == 1\nGROUP BY q, indicator\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , 'Trade and other accounts receivable' as indicator, 1700 as v)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , 'Inventories' as indicator, 1850 as v)) as n\nLEFT JOIN (SELECT * FROM financial_highlights \nUNION ALL (SELECT 'NLMK' as sec_code, toDate(toStartOfQuarter(date_add(month, 1, now()))) as quarter, 'Q3 2021' as quarter_name, 'REVENUE' as indicator, 4400 as value)) as h on h.quarter == n.q\nWHERE h.sec_code == 'NLMK' and h.indicator == 'REVENUE'\nGROUP BY q\nORDER BY q",
          "refId": "A",
          "round": "0s",
          "skip_comments": true,
          "table": "financial_ratios",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": true,
          "intervalFactor": 1,
          "query": "SELECT q, sum(n.v)/(last_value(h.value)*4)*100 as \"NWC/(Revenue L3m*4)\"\nFROM (SELECT\n    $dateCol as q,\n    indicator,\n    last_value(value) as v\nFROM $table\nWHERE sec_code == 'NLMK' and has(array('Trade and other accounts receivable','Inventories'), indicator) == 1\nGROUP BY q, indicator\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , 'Trade and other accounts receivable' as indicator, 1700 as v)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , 'Inventories' as indicator, 1850 as v)) as n\nLEFT JOIN financial_highlights as h on h.quarter == n.q\nWHERE h.sec_code == 'NLMK' and h.indicator == 'REVENUE'\nGROUP BY q\n\nORDER BY q\n",
          "queryType": "randomWalk",
          "rawQuery": "SELECT q, sum(n.v)/(last_value(h.value)*4)*100 as \"NWC/(Revenue L3m*4)\"\nFROM (SELECT\n    quarter as q,\n    indicator,\n    last_value(value) as v\nFROM default.financial_ratios\nWHERE sec_code == 'NLMK' and has(array('Trade and other accounts receivable','Inventories'), indicator) == 1\nGROUP BY q, indicator\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , 'Trade and other accounts receivable' as indicator, 1700 as v)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , 'Inventories' as indicator, 1850 as v)) as n\nLEFT JOIN financial_highlights as h on h.quarter == n.q\nWHERE h.sec_code == 'NLMK' and h.indicator == 'REVENUE'\nGROUP BY q\n\nORDER BY q",
          "refId": "C",
          "round": "0s",
          "skip_comments": true,
          "table": "financial_ratios",
          "tableLoading": false
        }
      ],
      "title": "Оборотные активы",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "axisSoftMin": 0,
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "masst"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "HVA"
            },
            "properties": [
              {
                "id": "custom.lineStyle",
                "value": {
                  "dash": [
                    10,
                    10
                  ],
                  "fill": "dash"
                }
              },
              {
                "id": "custom.stacking",
                "value": {
                  "group": "A",
                  "mode": "none"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 75
      },
      "id": 30,
      "options": {
        "legend": {
          "calcs": [
            "last",
            "mean"
          ],
          "displayMode": "table",
          "placement": "right"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT q, product, last_value(ton) FROM (SELECT\n    quarter as q,\n    product,\n    last_value(value) as ton\nFROM $table\nWHERE sec_code == 'NLMK' and has(array(\n'Semi-finished products',\n'Flat products',\n'Long products'), product) == 1\nGROUP BY q, product \nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 2, now()))) as q , 'Semi-finished products' as product, 1650 as ton)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 2, now()))) as q , 'Flat products' as product, 2050 as ton)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 2, now()))) as q , 'Long products' as product, 600 as ton))\nGROUP BY q, product\nORDER BY q, last_value(ton)\n",
          "queryType": "randomWalk",
          "rawQuery": "SELECT q, product, last_value(ton) FROM (SELECT\n    quarter as q,\n    product,\n    last_value(value) as ton\nFROM default.consolidated_sales_for_products\nWHERE sec_code == 'NLMK' and has(array(\n'Semi-finished products',\n'Flat products',\n'Long products'), product) == 1\nGROUP BY q, product \nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 2, now()))) as q , 'Semi-finished products' as product, 1650 as ton)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 2, now()))) as q , 'Flat products' as product, 2050 as ton)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 2, now()))) as q , 'Long products' as product, 600 as ton))\nGROUP BY q, product\nORDER BY q, last_value(ton)",
          "refId": "B",
          "round": "0s",
          "skip_comments": true,
          "table": "consolidated_sales_for_products",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": true,
          "intervalFactor": 1,
          "query": "select q, sum(ton) from (SELECT\n    quarter as q,\n    product,\n    last_value(value) as ton\nFROM $table\nWHERE sec_code == 'NLMK' and has(array(\n'Semi-finished products',\n'Flat products',\n'Long products'), product) == 1\nGROUP BY q, product \nORDER BY q, ton desc)\nGROUP BY q",
          "queryType": "randomWalk",
          "rawQuery": "select q, sum(ton) from (SELECT\n    quarter as q,\n    product,\n    last_value(value) as ton\nFROM default.consolidated_sales_for_products\nWHERE sec_code == 'NLMK' and has(array(\n'Semi-finished products',\n'Flat products',\n'Long products'), product) == 1\nGROUP BY q, product \nORDER BY q, ton desc)\nGROUP BY q",
          "refId": "A",
          "round": "0s",
          "skip_comments": true,
          "table": "consolidated_sales_for_products",
          "tableLoading": false
        }
      ],
      "title": "Структура продаж в тоннах по видам продукции",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "axisSoftMin": 0,
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "masst"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "HVA"
            },
            "properties": [
              {
                "id": "custom.lineStyle",
                "value": {
                  "dash": [
                    10,
                    10
                  ],
                  "fill": "dash"
                }
              },
              {
                "id": "custom.stacking",
                "value": {
                  "group": "A",
                  "mode": "none"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 83
      },
      "id": 41,
      "options": {
        "legend": {
          "calcs": [
            "last",
            "mean"
          ],
          "displayMode": "table",
          "placement": "right"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT q, sum(ton) FROM (SELECT\n    quarter as q,\n    product,\n    last_value(value) as ton\nFROM $table\nWHERE sec_code == 'NLMK' and has(array(\n'Semi-finished products',\n'Flat products',\n'Long products'), product) == 1\nGROUP BY q, product \nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 2, now()))) as q , 'Semi-finished products' as product, 1750 as ton)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 2, now()))) as q , 'Flat products' as product, 2140 as ton)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 2, now()))) as q , 'Long products' as product, 600 as ton))\nGROUP BY q\nORDER BY q\n",
          "queryType": "randomWalk",
          "rawQuery": "SELECT q, sum(ton) FROM (SELECT\n    quarter as q,\n    product,\n    last_value(value) as ton\nFROM default.consolidated_sales_for_products\nWHERE sec_code == 'NLMK' and has(array(\n'Semi-finished products',\n'Flat products',\n'Long products'), product) == 1\nGROUP BY q, product \nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 2, now()))) as q , 'Semi-finished products' as product, 1750 as ton)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 2, now()))) as q , 'Flat products' as product, 2140 as ton)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 2, now()))) as q , 'Long products' as product, 600 as ton))\nGROUP BY q\nORDER BY q",
          "refId": "B",
          "round": "0s",
          "skip_comments": true,
          "table": "consolidated_sales_for_products",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": true,
          "intervalFactor": 1,
          "query": "select q, sum(ton) from (SELECT\n    quarter as q,\n    product,\n    last_value(value) as ton\nFROM $table\nWHERE sec_code == 'NLMK' and has(array(\n'Semi-finished products',\n'Flat products',\n'Long products'), product) == 1\nGROUP BY q, product \nORDER BY q, ton desc)\nGROUP BY q",
          "queryType": "randomWalk",
          "rawQuery": "select q, sum(ton) from (SELECT\n    quarter as q,\n    product,\n    last_value(value) as ton\nFROM default.consolidated_sales_for_products\nWHERE sec_code == 'NLMK' and has(array(\n'Semi-finished products',\n'Flat products',\n'Long products'), product) == 1\nGROUP BY q, product \nORDER BY q, ton desc)\nGROUP BY q",
          "refId": "A",
          "round": "0s",
          "skip_comments": true,
          "table": "consolidated_sales_for_products",
          "tableLoading": false
        }
      ],
      "title": "Структура продаж в тоннах по видам продукции",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "axisSoftMin": 0,
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "normal"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "masst"
        },
        "overrides": [
          {
            "__systemRef": "hideSeriesFrom",
            "matcher": {
              "id": "byNames",
              "options": {
                "mode": "exclude",
                "names": [
                  "South East Asia",
                  "CIS",
                  "Other"
                ],
                "prefix": "All except:",
                "readOnly": true
              }
            },
            "properties": [
              {
                "id": "custom.hideFrom",
                "value": {
                  "legend": false,
                  "tooltip": false,
                  "viz": true
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 91
      },
      "id": 33,
      "options": {
        "legend": {
          "calcs": [
            "last",
            "mean"
          ],
          "displayMode": "table",
          "placement": "right"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    quarter as q,\n    product,\n    last_value(value) as ton\nFROM $table\nWHERE sec_code == 'NLMK' and has(array(\n'Russia',\n'EU',\n'M. East (incl. Turkey)', 'North America', 'South East Asia', 'Central and South America', 'CIS', 'Other'), product) == 1\nGROUP BY q, product \nORDER BY q, ton desc",
          "queryType": "randomWalk",
          "rawQuery": "SELECT\n    quarter as q,\n    product,\n    last_value(value) as ton\nFROM default.consolidated_sales_for_products\nWHERE sec_code == 'NLMK' and has(array(\n'Russia',\n'EU',\n'M. East (incl. Turkey)', 'North America', 'South East Asia', 'Central and South America', 'CIS', 'Other'), product) == 1\nGROUP BY q, product \nORDER BY q, ton desc",
          "refId": "B",
          "round": "0s",
          "skip_comments": true,
          "table": "consolidated_sales_for_products",
          "tableLoading": false
        }
      ],
      "title": "Структура продаж в тоннах по регионам",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 99
      },
      "id": 11,
      "panels": [],
      "title": "Production & Sales",
      "type": "row"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "HRC_FOB_CHINA"
            },
            "properties": [
              {
                "id": "custom.lineStyle",
                "value": {
                  "dash": [
                    10,
                    10
                  ],
                  "fill": "dash"
                }
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 100
      },
      "id": 17,
      "options": {
        "legend": {
          "calcs": [
            "last",
            "mean"
          ],
          "displayMode": "table",
          "placement": "right"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT q, v as \"Revenue per tonne\" FROM (SELECT\n    $dateCol as q,\n    last_value(value) as v\nFROM $table\nWHERE sec_code == 'NLMK' and indicator == 'Revenue per tonne of sales, $/t'\nGROUP BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 2, now()))) as q ,960 as v))\nORDER BY q",
          "rawQuery": "SELECT q, v as \"Revenue per tonne\" FROM (SELECT\n    quarter as q,\n    last_value(value) as v\nFROM default.financial_ratios\nWHERE sec_code == 'NLMK' and indicator == 'Revenue per tonne of sales, $/t'\nGROUP BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 2, now()))) as q ,960 as v))\nORDER BY q",
          "refId": "F",
          "round": "0s",
          "skip_comments": true,
          "table": "financial_ratios",
          "tableLoading": false
        },
        {
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateTimeType": "DATETIME",
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT * FROM (SELECT\n  quarter as q,\n  floor(revenue.value*1000/sales.value) as \"Longs\"\nFROM consolidated_sales_for_products as sales\nLEFT JOIN (SELECT sec_code,\n                    quarter as q,\n                    last_value(value) as value\n                FROM default.revenue_structure\n                WHERE sec_code == 'NLMK' and structure == 'Longs'\n                GROUP BY q, sec_code\n) as revenue\nON revenue.sec_code = sales.sec_code and revenue.q = sales.quarter \nwhere sales.product == 'Long products' and sec_code == 'NLMK'\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 2, now()))) as q , $forecast_PriceAverage - 290)\n)\nORDER BY q\n",
          "rawQuery": "SELECT * FROM (SELECT\n  quarter as q,\n  floor(revenue.value*1000/sales.value) as \"Longs\"\nFROM consolidated_sales_for_products as sales\nLEFT JOIN (SELECT sec_code,\n                    quarter as q,\n                    last_value(value) as value\n                FROM default.revenue_structure\n                WHERE sec_code == 'NLMK' and structure == 'Longs'\n                GROUP BY q, sec_code\n) as revenue\nON revenue.sec_code = sales.sec_code and revenue.q = sales.quarter \nwhere sales.product == 'Long products' and sec_code == 'NLMK'\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 2, now()))) as q , 995 - 290)\n)\nORDER BY q",
          "refId": "C",
          "round": "0s",
          "skip_comments": true
        },
        {
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateTimeType": "DATETIME",
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT * FROM (SELECT\n  quarter as q,\n  floor(revenue.value/sales.value * 1000) as \"HRC\"\nFROM consolidated_sales_for_products as sales\nLEFT JOIN (SELECT sec_code, q, sum(v) as value\n           FROM (\n                SELECT\n                    sec_code,\n                    quarter as q,\n                    structure,\n                    last_value(value) as v\n                FROM default.revenue_structure\n                WHERE sec_code == 'NLMK'\n                  and has(array('HRC'), structure) == 1\n                GROUP BY q, structure, sec_code)\n           GROUP BY q, sec_code\n) as revenue\nON revenue.sec_code = sales.sec_code and revenue.q = sales.quarter\nwhere sales.product == 'HRC' and sec_code == 'NLMK'\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , $forecast_PriceAverage)\n)\nORDER BY q\n",
          "rawQuery": "SELECT * FROM (SELECT\n  quarter as q,\n  floor(revenue.value/sales.value * 1000) as \"HRC\"\nFROM consolidated_sales_for_products as sales\nLEFT JOIN (SELECT sec_code, q, sum(v) as value\n           FROM (\n                SELECT\n                    sec_code,\n                    quarter as q,\n                    structure,\n                    last_value(value) as v\n                FROM default.revenue_structure\n                WHERE sec_code == 'NLMK'\n                  and has(array('HRC'), structure) == 1\n                GROUP BY q, structure, sec_code)\n           GROUP BY q, sec_code\n) as revenue\nON revenue.sec_code = sales.sec_code and revenue.q = sales.quarter\nwhere sales.product == 'HRC' and sec_code == 'NLMK'\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 3, now()))) as q , 995)\n)\nORDER BY q",
          "refId": "A",
          "round": "0s",
          "skip_comments": true
        },
        {
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateTimeType": "DATETIME",
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT * FROM (SELECT\n  quarter as q,\n  floor(revenue.value/sales.value * 1000) as \"Slabs\"\nFROM consolidated_sales_for_products as sales\nLEFT JOIN (SELECT sec_code, q, sum(v) as value\n           FROM (\n                SELECT\n                    sec_code,\n                    quarter as q,\n                    structure,\n                    last_value(value) as v\n                FROM default.revenue_structure\n                WHERE sec_code == 'NLMK'\n                  and has(array('Slabs'), structure) == 1\n                GROUP BY q, structure, sec_code)\n           GROUP BY q, sec_code\n) as revenue\nON revenue.sec_code = sales.sec_code and revenue.q = sales.quarter\nwhere sales.product == 'Slabs' and sec_code == 'NLMK'\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 2, now()))) as q , $forecast_PriceAverage - 280)\n)\nORDER BY q\n",
          "rawQuery": "SELECT * FROM (SELECT\n  quarter as q,\n  floor(revenue.value/sales.value * 1000) as \"Slabs\"\nFROM consolidated_sales_for_products as sales\nLEFT JOIN (SELECT sec_code, q, sum(v) as value\n           FROM (\n                SELECT\n                    sec_code,\n                    quarter as q,\n                    structure,\n                    last_value(value) as v\n                FROM default.revenue_structure\n                WHERE sec_code == 'NLMK'\n                  and has(array('Slabs'), structure) == 1\n                GROUP BY q, structure, sec_code)\n           GROUP BY q, sec_code\n) as revenue\nON revenue.sec_code = sales.sec_code and revenue.q = sales.quarter\nwhere sales.product == 'Slabs' and sec_code == 'NLMK'\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 2, now()))) as q , 995 - 280)\n)\nORDER BY q",
          "refId": "B",
          "round": "0s",
          "skip_comments": true
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT * FROM (SELECT\n  quarter as q,\n  floor(revenue.value/sales.value * 1000) as \"HVA\"\nFROM $table as revenue\nLEFT JOIN (SELECT sec_code, quarter, sum(v) as value\n           FROM (\n                SELECT\n                    sec_code,\n                    quarter,\n                    product,\n                    last_value(value) as v\n                FROM consolidated_sales_for_products\n                WHERE sec_code == 'NLMK'\n                  and has(array('Plates', 'CRC', 'HDG', 'Coated', 'Dynamo', 'Transformer', 'Metalware'), product) == 1\n                GROUP BY quarter, product, sec_code)\n           GROUP BY quarter, sec_code\n) as sales\nON revenue.sec_code = sales.sec_code and revenue.quarter = sales.quarter\nwhere revenue.structure == 'High value added products' and sec_code == 'NLMK' and revenue.$dateCol >= toDate($from) and revenue.$dateCol <= toDate($to)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 2, now()))) as q , $forecast_PriceAverage + 120)\n)\nORDER BY q\n",
          "rawQuery": "SELECT * FROM (SELECT\n  quarter as q,\n  floor(revenue.value/sales.value * 1000) as \"HVA\"\nFROM default.revenue_structure as revenue\nLEFT JOIN (SELECT sec_code, quarter, sum(v) as value\n           FROM (\n                SELECT\n                    sec_code,\n                    quarter,\n                    product,\n                    last_value(value) as v\n                FROM consolidated_sales_for_products\n                WHERE sec_code == 'NLMK'\n                  and has(array('Plates', 'CRC', 'HDG', 'Coated', 'Dynamo', 'Transformer', 'Metalware'), product) == 1\n                GROUP BY quarter, product, sec_code)\n           GROUP BY quarter, sec_code\n) as sales\nON revenue.sec_code = sales.sec_code and revenue.quarter = sales.quarter\nwhere revenue.structure == 'High value added products' and sec_code == 'NLMK' and revenue.quarter >= toDate(1574976493) and revenue.quarter <= toDate(1646074799)\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 2, now()))) as q , 995 + 120)\n)\nORDER BY q",
          "refId": "E",
          "round": "0s",
          "skip_comments": true,
          "table": "revenue_structure",
          "tableLoading": false
        },
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "date",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    toDate(toStartOfQuarter(date_add(month, $price_lag_months, date))) as q,\n    avg(close) as HRC_FOB_CHINA\nFROM $table\nWHERE code == 'MHCc1' and $dateCol >= toDate($from) and $dateCol <= toDate($to)\nGROUP BY q\nORDER BY q",
          "rawQuery": "SELECT\n    toDate(toStartOfQuarter(date_add(month, 2, date))) as q,\n    avg(close) as HRC_FOB_CHINA\nFROM default.stock_prices\nWHERE code == 'MHCc1' and date >= toDate(1574976493) and date <= toDate(1646074799)\nGROUP BY q\nORDER BY q",
          "refId": "D",
          "round": "0s",
          "skip_comments": true,
          "table": "stock_prices",
          "tableLoading": false
        }
      ],
      "title": "Цены прокатной продукции за тонну",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 108
      },
      "id": 32,
      "options": {
        "legend": {
          "calcs": [
            "last",
            "mean"
          ],
          "displayMode": "table",
          "placement": "right"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "database": "default",
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateColDataType": "date",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "select\n    toDate(toStartOfQuarter(date_add(week, 6, date))) as q,\n    avg(close)/17.4 as \"Coking Coal CHINA\"\nfrom $table\nWHERE code == 'DJMc1' and q >= toDate($from) and q <= toDate($to)\nGROUP BY q\nORDER BY q\n",
          "rawQuery": "select\n    toDate(toStartOfQuarter(date_add(week, 6, date))) as q,\n    avg(close)/17.4 as \"Coking Coal CHINA\"\nfrom default.stock_prices\nWHERE code == 'DJMc1' and q >= toDate(1574978873) and q <= toDate(1646074799)\nGROUP BY q\nORDER BY q",
          "refId": "C",
          "round": "0s",
          "skip_comments": true,
          "table": "stock_prices",
          "tableLoading": false
        },
        {
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "dateTimeType": "DATETIME",
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT * FROM (SELECT\n  quarter as q,\n  floor(revenue.value*1000/sales.value) as \"Coke and coal price\"\nFROM revenue_structure as sales\nLEFT JOIN (SELECT sec_code,\n                    quarter as q,\n                    last_value(value) as value\n                FROM default.cost_of_sales_structure\n                WHERE sec_code == 'NLMK' and structure == 'Coke and coal'\n           GROUP BY q, sec_code\n) as revenue\nON revenue.sec_code = sales.sec_code and revenue.q = sales.quarter\nwhere sales.structure == 'TOTAL SALES'\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 2, now()))) as q ,  100)\n)\nWHERE q >= toDate($from) and q <= toDate($to)\nORDER BY q\n",
          "rawQuery": "SELECT * FROM (SELECT\n  quarter as q,\n  floor(revenue.value*1000/sales.value) as \"Coke and coal price\"\nFROM revenue_structure as sales\nLEFT JOIN (SELECT sec_code,\n                    quarter as q,\n                    last_value(value) as value\n                FROM default.cost_of_sales_structure\n                WHERE sec_code == 'NLMK' and structure == 'Coke and coal'\n           GROUP BY q, sec_code\n) as revenue\nON revenue.sec_code = sales.sec_code and revenue.q = sales.quarter\nwhere sales.structure == 'TOTAL SALES'\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 2, now()))) as q ,  100)\n)\nWHERE q >= toDate(1574978873) and q <= toDate(1646074799)\nORDER BY q",
          "refId": "A",
          "round": "0s",
          "skip_comments": true
        }
      ],
      "title": "Корреляция индекса Фьючерс на кокс. уголь и затраты на уголь",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 10,
        "w": 24,
        "x": 0,
        "y": 116
      },
      "id": 31,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "database": "default",
          "dateColDataType": "",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "select\n    toDate(toStartOfQuarter(date_add(month, $price_lag_months, date))) as q,\n    avg(close) as 62PercFe\nfrom $table\nWHERE code == 'SGXIOSc1'\nGROUP BY q\nORDER BY q\n",
          "rawQuery": "select\n    toDate(toStartOfQuarter(date_add(month, 2, date))) as q,\n    avg(close) as 62PercFe\nfrom default.stock_prices\nWHERE code == 'SGXIOSc1'\nGROUP BY q\nORDER BY q",
          "refId": "B",
          "round": "0s",
          "skip_comments": true,
          "table": "stock_prices",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    $dateCol as q,\n    last_value(price) as Index62Fe\nFROM $table\nWHERE product == 'Fe'\nGROUP BY q\nORDER BY q\n",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(price) as Index62Fe\nFROM default.fob_prices\nWHERE product == 'Fe'\nGROUP BY q\nORDER BY q",
          "refId": "C",
          "round": "0s",
          "skip_comments": true,
          "table": "fob_prices",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "intervalFactor": 1,
          "query": "SELECT q, sum(perc) as IronSlab FROM (\nSELECT\n    quarter as q,\n    last_value(slab_cash_cost_structure.value)*last_value(financial_ratios.value) as perc\nFROM slab_cash_cost_structure\n       LEFT JOIN financial_ratios ON\n           financial_ratios.quarter == slab_cash_cost_structure.quarter\n        and financial_ratios.sec_code == slab_cash_cost_structure.sec_code\nWHERE (structure == 'Pellets'\n   or structure == 'Iron ore & concentrate'\n   or structure == 'Metal scrap')\n   and indicator == 'Slab Cash cost (USD/t)'\nGROUP BY q, structure)\nGROUP BY q\nORDER BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , $forecast_IronSlab)",
          "queryType": "randomWalk",
          "rawQuery": "SELECT q, sum(perc) as IronSlab FROM (\nSELECT\n    quarter as q,\n    last_value(slab_cash_cost_structure.value)*last_value(financial_ratios.value) as perc\nFROM slab_cash_cost_structure\n       LEFT JOIN financial_ratios ON\n           financial_ratios.quarter == slab_cash_cost_structure.quarter\n        and financial_ratios.sec_code == slab_cash_cost_structure.sec_code\nWHERE (structure == 'Pellets'\n   or structure == 'Iron ore & concentrate'\n   or structure == 'Metal scrap')\n   and indicator == 'Slab Cash cost (USD/t)'\nGROUP BY q, structure)\nGROUP BY q\nORDER BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , 244)",
          "refId": "A",
          "round": "0s",
          "skip_comments": true,
          "table": "material_cost_structure",
          "tableLoading": false
        }
      ],
      "title": "Корреляция индекса ЖРС и железной части кеш-кост сляба",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "vertamedia-clickhouse-datasource",
        "uid": "clickhouse"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisLabel": "",
            "axisPlacement": "left",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "smooth",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "currencyUSD"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 126
      },
      "id": 15,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "database": "default",
          "dateColDataType": "date",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "select\n    toDate(toStartOfQuarter(date_add(month, $price_lag_months, date))) as q,\n    avg(close) as US_HRC\nfrom $table\nWHERE code == 'HRCc1'\nGROUP BY q\nORDER BY q",
          "queryType": "randomWalk",
          "rawQuery": "select\n    toDate(toStartOfQuarter(date_add(month, 4, date))) as q,\n    avg(close) as US_HRC\nfrom default.stock_prices\nWHERE code == 'HRCc1'\nGROUP BY q\nORDER BY q",
          "refId": "D",
          "round": "0s",
          "skip_comments": true,
          "table": "stock_prices",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "date",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    toDate(toStartOfQuarter(date_add(month, $price_lag_months, date))) as q,\n    avg(close) as HRC_FOB_CHINA\nFROM $table\n\nWHERE code == 'MHCc1'\n\nGROUP BY q\n\nORDER BY q\n",
          "queryType": "randomWalk",
          "rawQuery": "SELECT\n    toDate(toStartOfQuarter(date_add(month, 4, date))) as q,\n    avg(close) as HRC_FOB_CHINA\nFROM default.stock_prices\n\nWHERE code == 'MHCc1'\n\nGROUP BY q\n\nORDER BY q",
          "refId": "E",
          "round": "0s",
          "skip_comments": true,
          "table": "stock_prices",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "date",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "select\n    toDate(toStartOfQuarter(date_add(month, $price_lag_months, date))) as q,\n    avg(M3) as LME_HC\nfrom $table\nWHERE code == 'HC'\nGROUP BY q\nORDER BY q\n",
          "queryType": "randomWalk",
          "rawQuery": "select\n    toDate(toStartOfQuarter(date_add(month, 4, date))) as q,\n    avg(M3) as LME_HC\nfrom default.lme_closing_prices\nWHERE code == 'HC'\nGROUP BY q\nORDER BY q",
          "refId": "A",
          "round": "0s",
          "skip_comments": true,
          "table": "lme_closing_prices",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "date",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "select\n    toDate(toStartOfQuarter(date_add(month, $price_lag_months, date))) as q,\n    avg(M12) as LME_HU\nfrom $table\nWHERE code == 'HU'\nGROUP BY q\nORDER BY q\n",
          "queryType": "randomWalk",
          "rawQuery": "select\n    toDate(toStartOfQuarter(date_add(month, 4, date))) as q,\n    avg(M12) as LME_HU\nfrom default.lme_closing_prices\nWHERE code == 'HU'\nGROUP BY q\nORDER BY q",
          "refId": "B",
          "round": "0s",
          "skip_comments": true,
          "table": "lme_closing_prices",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": false,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": true,
          "intervalFactor": 1,
          "query": "SELECT\n    $dateCol as q,\n    last_value(price) as ConsolidateFlatHotRolled\nFROM $table\nWHERE product == 'Flat hot-rolled products'\nGROUP BY q\nORDER BY q",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(price) as ConsolidateFlatHotRolled\nFROM default.consolidated_prices_for_products\nWHERE product == 'Flat hot-rolled products'\nGROUP BY q\nORDER BY q",
          "refId": "C",
          "round": "0s",
          "skip_comments": true,
          "table": "consolidated_prices_for_products",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "date",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": true,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "select\n    toDate(toStartOfQuarter(date_add(month, $price_lag_months, date))) as q,\n    avg(close)/8 as SHHCc1\nfrom $table\nWHERE code == 'SHHCc1'\nGROUP BY q\nORDER BY q",
          "queryType": "randomWalk",
          "rawQuery": "select\n    toDate(toStartOfQuarter(date_add(month, 4, date))) as q,\n    avg(close)/8 as SHHCc1\nfrom default.stock_prices\nWHERE code == 'SHHCc1'\nGROUP BY q\nORDER BY q",
          "refId": "F",
          "round": "0s",
          "skip_comments": true,
          "table": "stock_prices",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": false,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    $dateCol as q,\n    last_value(price) as FlatHotRolled\nFROM $table\nWHERE product == 'Flat hot-rolled products'\nGROUP BY q\nORDER BY q",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(price) as FlatHotRolled\nFROM default.prices_for_products\nWHERE product == 'Flat hot-rolled products'\nGROUP BY q\nORDER BY q",
          "refId": "G",
          "round": "0s",
          "skip_comments": true,
          "table": "prices_for_products",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": false,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    $dateCol as q,\n    last_value(price) as MMK_CHINA\nFROM $table\nWHERE product == 'HRC FOB CHINA'\nGROUP BY q\nORDER BY q",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(price) as MMK_CHINA\nFROM default.fob_prices\nWHERE product == 'HRC FOB CHINA'\nGROUP BY q\nORDER BY q",
          "refId": "H",
          "round": "0s",
          "skip_comments": true,
          "table": "fob_prices",
          "tableLoading": false
        },
        {
          "database": "default",
          "dateColDataType": "quarter",
          "dateLoading": false,
          "dateTimeType": "DATETIME",
          "datetimeLoading": false,
          "extrapolate": false,
          "format": "time_series",
          "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
          "hide": false,
          "intervalFactor": 1,
          "query": "SELECT\n    $dateCol as q,\n    last_value(price) as MMK_BLACK_SEA\nFROM $table\nWHERE product == 'HRC FOB Black sea'\nGROUP BY q\nORDER BY q",
          "rawQuery": "SELECT\n    quarter as q,\n    last_value(price) as MMK_BLACK_SEA\nFROM default.fob_prices\nWHERE product == 'HRC FOB Black sea'\nGROUP BY q\nORDER BY q",
          "refId": "I",
          "round": "0s",
          "skip_comments": true,
          "table": "fob_prices",
          "tableLoading": false
        }
      ],
      "title": "Средневзвешенная цена готовой продукции  в дол. США",
      "transformations": [],
      "type": "timeseries"
    },
    {
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 134
      },
      "id": 19,
      "panels": [
        {
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "smooth",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "currencyUSD"
            },
            "overrides": [
              {
                "__systemRef": "hideSeriesFrom",
                "matcher": {
                  "id": "byNames",
                  "options": {
                    "mode": "exclude",
                    "names": [
                      "Coke and coal"
                    ],
                    "prefix": "All except:",
                    "readOnly": true
                  }
                },
                "properties": [
                  {
                    "id": "custom.hideFrom",
                    "value": {
                      "legend": false,
                      "tooltip": false,
                      "viz": true
                    }
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 9,
            "w": 24,
            "x": 0,
            "y": 4
          },
          "id": 23,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "right"
            },
            "tooltip": {
              "mode": "single"
            }
          },
          "targets": [
            {
              "database": "default",
              "datasource": {
                "type": "vertamedia-clickhouse-datasource",
                "uid": "clickhouse"
              },
              "dateColDataType": "quarter",
              "dateLoading": false,
              "dateTimeType": "DATETIME",
              "datetimeLoading": false,
              "extrapolate": true,
              "format": "time_series",
              "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
              "intervalFactor": 1,
              "query": "SELECT\n    quarter as q,\n    structure,\n    last_value(value)\nFROM $table\nWHERE sec_code == 'NLMK' and structure != 'Other expenses and changes in inventories' and q >= toDate($from) and q <= toDate($to)\nGROUP BY q, structure\nORDER BY q, sum(value) desc\n",
              "queryType": "randomWalk",
              "rawQuery": "SELECT\n    quarter as q,\n    structure,\n    last_value(value)\nFROM default.cost_of_sales_structure\nWHERE sec_code == 'NLMK' and structure != 'Other expenses and changes in inventories' and q >= toDate(1574978277) and q <= toDate(1646074799)\nGROUP BY q, structure\nORDER BY q, sum(value) desc",
              "refId": "A",
              "round": "0s",
              "skip_comments": true,
              "table": "cost_of_sales_structure",
              "tableLoading": false
            }
          ],
          "title": "Затраты,  USD mln",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "smooth",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "currencyUSD"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 13
          },
          "id": 25,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom"
            },
            "tooltip": {
              "mode": "single"
            }
          },
          "targets": [
            {
              "database": "default",
              "dateColDataType": "",
              "dateLoading": false,
              "dateTimeType": "DATETIME",
              "datetimeLoading": false,
              "extrapolate": true,
              "format": "time_series",
              "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
              "hide": false,
              "intervalFactor": 1,
              "query": "select\n    toDate(toStartOfQuarter(date_add(month, $price_lag_months, date))) as q,\n    avg(close) as 62PercFe\nfrom $table\nWHERE code == 'SGXIOSc1'\nGROUP BY q\nORDER BY q\n",
              "rawQuery": "select\n    toDate(toStartOfQuarter(date_add(month, 4, date))) as q,\n    avg(close) as 62PercFe\nfrom default.stock_prices\nWHERE code == 'SGXIOSc1'\nGROUP BY q\nORDER BY q",
              "refId": "B",
              "round": "0s",
              "skip_comments": true,
              "table": "stock_prices",
              "tableLoading": false
            },
            {
              "database": "default",
              "dateColDataType": "quarter",
              "dateLoading": false,
              "dateTimeType": "DATETIME",
              "datetimeLoading": false,
              "extrapolate": true,
              "format": "time_series",
              "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
              "hide": false,
              "intervalFactor": 1,
              "query": "SELECT\n    $dateCol as q,\n    last_value(price) as Index62Fe\nFROM $table\nWHERE product == 'Fe'\nGROUP BY q\nORDER BY q\n",
              "rawQuery": "SELECT\n    quarter as q,\n    last_value(price) as Index62Fe\nFROM default.fob_prices\nWHERE product == 'Fe'\nGROUP BY q\nORDER BY q",
              "refId": "C",
              "round": "0s",
              "skip_comments": true,
              "table": "fob_prices",
              "tableLoading": false
            },
            {
              "database": "default",
              "dateColDataType": "quarter",
              "dateLoading": false,
              "dateTimeType": "DATETIME",
              "datetimeLoading": false,
              "extrapolate": true,
              "format": "time_series",
              "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
              "hide": true,
              "intervalFactor": 1,
              "query": "SELECT q, sum(perc) as IronSlab FROM (\nSELECT\n    quarter as q,\n    last_value(slab_cash_cost_structure.value)*last_value(financial_ratios.value) as perc\nFROM slab_cash_cost_structure\n       LEFT JOIN financial_ratios ON\n           financial_ratios.quarter == slab_cash_cost_structure.quarter\n        and financial_ratios.sec_code == slab_cash_cost_structure.sec_code\nWHERE (structure == 'Pellets'\n   or structure == 'Iron ore & concentrate'\n   or structure == 'Metal scrap')\n   and indicator == 'Slab Cash cost (USD/t)'\nGROUP BY q, structure)\nGROUP BY q\nORDER BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , $forecast_IronSlab)",
              "queryType": "randomWalk",
              "rawQuery": "SELECT q, sum(perc) as IronSlab FROM (\nSELECT\n    quarter as q,\n    last_value(slab_cash_cost_structure.value)*last_value(financial_ratios.value) as perc\nFROM slab_cash_cost_structure\n       LEFT JOIN financial_ratios ON\n           financial_ratios.quarter == slab_cash_cost_structure.quarter\n        and financial_ratios.sec_code == slab_cash_cost_structure.sec_code\nWHERE (structure == 'Pellets'\n   or structure == 'Iron ore & concentrate'\n   or structure == 'Metal scrap')\n   and indicator == 'Slab Cash cost (USD/t)'\nGROUP BY q, structure)\nGROUP BY q\nORDER BY q\nUNION ALL (SELECT toDate(toStartOfQuarter(date_add(month, 1, now()))) as q , 244)",
              "refId": "A",
              "round": "0s",
              "skip_comments": true,
              "table": "material_cost_structure",
              "tableLoading": false
            },
            {
              "database": "default",
              "dateColDataType": "quarter",
              "dateLoading": false,
              "dateTimeType": "DATETIME",
              "datetimeLoading": false,
              "extrapolate": true,
              "format": "time_series",
              "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
              "hide": false,
              "intervalFactor": 1,
              "query": "SELECT\n    quarter as q,\n    last_value(value)\nFROM $table WHERE sec_code == 'NLMK' and structure == 'Iron ore materials'\nGROUP BY q\nORDER BY q",
              "rawQuery": "SELECT\n    quarter as q,\n    last_value(value)\nFROM default.cost_of_sales_structure WHERE sec_code == 'NLMK' and structure == 'Iron ore materials'\nGROUP BY q\nORDER BY q",
              "refId": "D",
              "round": "0s",
              "skip_comments": true,
              "table": "cost_of_sales_structure",
              "tableLoading": false
            }
          ],
          "title": "Корреляция индекса ЖРС и железной части кеш-кост сляба",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "smooth",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "masst"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 13
          },
          "id": 34,
          "options": {
            "legend": {
              "calcs": [
                "last",
                "mean"
              ],
              "displayMode": "list",
              "placement": "bottom"
            },
            "tooltip": {
              "mode": "single"
            }
          },
          "targets": [
            {
              "database": "default",
              "dateColDataType": "month",
              "dateLoading": false,
              "dateTimeType": "DATETIME",
              "datetimeLoading": false,
              "extrapolate": true,
              "format": "time_series",
              "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
              "hide": false,
              "intervalFactor": 1,
              "query": "SELECT\n    $dateCol as q,\n    name,\n    last_value(quantity)\nFROM $table\nWHERE code == '72 (кроме 7201-7204)' or code=='7208-7212' \nGROUP BY q,name\nORDER BY q\n",
              "rawQuery": "SELECT\n    month as q,\n    name,\n    last_value(quantity)\nFROM default.export_goods\nWHERE code == '72 (кроме 7201-7204)' or code=='7208-7212' \nGROUP BY q,name\nORDER BY q",
              "refId": "C",
              "round": "0s",
              "skip_comments": true,
              "table": "export_goods",
              "tableLoading": false
            }
          ],
          "title": "Экспорт  России",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "vertamedia-clickhouse-datasource",
            "uid": "clickhouse"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineInterpolation": "smooth",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": null
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "currencyUSD"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 24,
            "x": 0,
            "y": 21
          },
          "id": 40,
          "options": {
            "legend": {
              "calcs": [
                "last",
                "mean"
              ],
              "displayMode": "list",
              "placement": "bottom"
            },
            "tooltip": {
              "mode": "single"
            }
          },
          "targets": [
            {
              "database": "default",
              "dateColDataType": "month",
              "dateLoading": false,
              "dateTimeType": "DATETIME",
              "datetimeLoading": false,
              "extrapolate": true,
              "format": "time_series",
              "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
              "hide": true,
              "intervalFactor": 1,
              "query": "SELECT\n    $dateCol as q,\n    last_value(if(runningDifference(export)>0,runningDifference(export),export)) as Export,\n    last_value(if(runningDifference(cis)>0,runningDifference(cis), cis)) as \"CIS\"\nFROM $table\n\nwhere name = 'ЧЕЛЯБИНСКАЯ ОБЛАСТЬ'\nGROUP BY q\nORDER BY q\n",
              "rawQuery": "SELECT\n    month as q,\n    last_value(if(runningDifference(export)>0,runningDifference(export),export)) as Export,\n    last_value(if(runningDifference(cis)>0,runningDifference(cis), cis)) as \"CIS\"\nFROM default.export_regions\n\nwhere name = 'ЧЕЛЯБИНСКАЯ ОБЛАСТЬ'\nGROUP BY q\nORDER BY q",
              "refId": "C",
              "round": "0s",
              "skip_comments": true,
              "table": "export_regions",
              "tableLoading": false
            },
            {
              "database": "default",
              "dateColDataType": "month",
              "dateLoading": false,
              "dateTimeType": "DATETIME",
              "datetimeLoading": false,
              "extrapolate": true,
              "format": "time_series",
              "formattedQuery": "SELECT $timeSeries as t, count() FROM $table WHERE $timeFilter GROUP BY t ORDER BY t",
              "hide": false,
              "intervalFactor": 1,
              "query": "SELECT\n    $dateCol as q,\n    last_value(if(runningDifference(export)>0,runningDifference(export),export)) as Export,\n    last_value(if(runningDifference(cis)>0,runningDifference(cis), cis)) as \"CIS\"\nFROM $table\n\nwhere name = 'ЛИПЕЦКАЯ ОБЛАСТЬ'\nGROUP BY q\nORDER BY q",
              "rawQuery": "SELECT\n    month as q,\n    last_value(if(runningDifference(export)>0,runningDifference(export),export)) as Export,\n    last_value(if(runningDifference(cis)>0,runningDifference(cis), cis)) as \"CIS\"\nFROM default.export_regions\n\nwhere name = 'ЛИПЕЦКАЯ ОБЛАСТЬ'\nGROUP BY q\nORDER BY q",
              "refId": "A",
              "round": "0s",
              "skip_comments": true,
              "table": "export_regions",
              "tableLoading": false
            }
          ],
          "title": "Экспорт ЛИПЕЦКАЯ область, млн. долл. США",
          "type": "timeseries"
        }
      ],
      "title": "COS breakdown",
      "type": "row"
    }
  ],
  "refresh": "",
  "schemaVersion": 34,
  "style": "dark",
  "tags": [],
  "templating": {
    "list": [
      {
        "current": {
          "selected": true,
          "text": "NLMK\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000",
          "value": "NLMK\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000"
        },
        "datasource": {
          "type": "vertamedia-clickhouse-datasource",
          "uid": "clickhouse"
        },
        "definition": "SELECT seccode FROM securities",
        "hide": 0,
        "includeAll": false,
        "label": "sec_code",
        "multi": false,
        "name": "sec_code",
        "options": [],
        "query": "SELECT seccode FROM securities",
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "type": "query"
      },
      {
        "current": {
          "selected": true,
          "text": "2",
          "value": "2"
        },
        "hide": 0,
        "includeAll": false,
        "multi": false,
        "name": "price_lag_months",
        "options": [
          {
            "selected": false,
            "text": "0",
            "value": "0"
          },
          {
            "selected": false,
            "text": "1",
            "value": "1"
          },
          {
            "selected": false,
            "text": "1.25",
            "value": "1.25"
          },
          {
            "selected": false,
            "text": "1.5",
            "value": "1.5"
          },
          {
            "selected": false,
            "text": "1.75",
            "value": "1.75"
          },
          {
            "selected": true,
            "text": "2",
            "value": "2"
          }
        ],
        "query": "0,1,1.25,1.5,1.75,2",
        "queryValue": "4",
        "skipUrlSync": false,
        "type": "custom"
      },
      {
        "current": {
          "selected": true,
          "text": "244",
          "value": "244"
        },
        "hide": 0,
        "includeAll": false,
        "label": "",
        "multi": false,
        "name": "forecast_IronSlab",
        "options": [
          {
            "selected": true,
            "text": "244",
            "value": "244"
          }
        ],
        "query": "244",
        "queryValue": "",
        "skipUrlSync": false,
        "type": "custom"
      },
      {
        "current": {
          "selected": false,
          "text": "995",
          "value": "995"
        },
        "hide": 0,
        "includeAll": false,
        "multi": false,
        "name": "forecast_PriceAverage",
        "options": [
          {
            "selected": true,
            "text": "825",
            "value": "825"
          }
        ],
        "query": "825",
        "queryValue": "995",
        "skipUrlSync": false,
        "type": "custom"
      },
      {
        "current": {
          "selected": false,
          "text": "510.5",
          "value": "510.5"
        },
        "datasource": {
          "type": "vertamedia-clickhouse-datasource",
          "uid": "clickhouse"
        },
        "definition": "SELECT floor(sum(perc)+$forecast_IronSlab,1) as Slab\nFROM (\n      SELECT last_value(quarter) as q,\n             last_value(slab_cash_cost_structure.value) * last_value(financial_ratios.value) as perc\n      FROM slab_cash_cost_structure\n               LEFT JOIN financial_ratios ON\n              financial_ratios.quarter == slab_cash_cost_structure.quarter\n              and financial_ratios.sec_code == slab_cash_cost_structure.sec_code\n      WHERE (structure == 'Pellets'\n   or structure == 'Iron ore & concentrate'\n   or structure == 'Metal scrap')\n        and indicator == 'Slab Cash cost (USD/t)'\n      GROUP BY structure)\nGROUP BY q\nORDER BY q",
        "description": "",
        "hide": 0,
        "includeAll": false,
        "multi": false,
        "name": "forecast_Slab",
        "options": [],
        "query": "SELECT floor(sum(perc)+$forecast_IronSlab,1) as Slab\nFROM (\n      SELECT last_value(quarter) as q,\n             last_value(slab_cash_cost_structure.value) * last_value(financial_ratios.value) as perc\n      FROM slab_cash_cost_structure\n               LEFT JOIN financial_ratios ON\n              financial_ratios.quarter == slab_cash_cost_structure.quarter\n              and financial_ratios.sec_code == slab_cash_cost_structure.sec_code\n      WHERE (structure == 'Pellets'\n   or structure == 'Iron ore & concentrate'\n   or structure == 'Metal scrap')\n        and indicator == 'Slab Cash cost (USD/t)'\n      GROUP BY structure)\nGROUP BY q\nORDER BY q",
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "type": "query"
      },
      {
        "current": {
          "selected": false,
          "text": "230",
          "value": "230"
        },
        "hide": 0,
        "includeAll": false,
        "multi": false,
        "name": "forecast_price",
        "options": [
          {
            "selected": true,
            "text": "300",
            "value": "300"
          }
        ],
        "query": "300",
        "queryValue": "230",
        "skipUrlSync": false,
        "type": "custom"
      },
      {
        "current": {
          "selected": false,
          "text": "5993.23",
          "value": "5993.23"
        },
        "hide": 0,
        "includeAll": false,
        "multi": false,
        "name": "shares",
        "options": [
          {
            "selected": true,
            "text": "5993.23",
            "value": "5993.23"
          }
        ],
        "query": "5993.23",
        "skipUrlSync": false,
        "type": "custom"
      }
    ]
  },
  "time": {
    "from": "now-5y",
    "to": "now"
  },
  "timepicker": {},
  "timezone": "",
  "title": "HLMK Forecast",
  "uid": "nlmk",
  "version": 2,
  "weekStart": ""
}